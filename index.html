<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ë°°ÈªûÂÅ•Ë∫´ - MOTI 3DÈ´îÊÖãÂàÜÊûê ÂõûÂ†±Ë°®</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root {
            --white: #ffffff;
            --gray: #808080;
            --green: #7ac19a;
            --green-light: #e2ede6;
            --green-dark: #5f846f;
            --pink: #f2ac98;
            --pink-light: #faece8;
            --pink-dark: #c67566;
            --yellow: #ffe08b;
            --yellow-light: #fcf4e3;
            --yellow-dark: #ba9e60;
            --blue: #9fcccc;
            --blue-light: #daedec;
            --blue-dark: #66888e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, var(--green-light) 0%, var(--blue-light) 100%);
            min-height: 100vh;
            color: #333;
            -webkit-tap-highlight-color: transparent;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 15px; }

        .header {
            background: var(--white);
            padding: 12px 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .logo {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--green-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo-icon {
            padding: 6px 10px;
            background: linear-gradient(135deg, var(--green) 0%, var(--green-dark) 100%);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 0.85rem;
            flex-shrink: 0;
        }
        .progress-container { display: flex; align-items: center; gap: 6px; }
        .progress-step {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 500; font-size: 0.85rem;
            background: var(--gray); color: white;
            transition: all 0.3s ease; cursor: pointer;
            flex-shrink: 0;
        }
        .progress-step.active {
            background: linear-gradient(135deg, var(--green) 0%, var(--green-dark) 100%);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(122, 193, 154, 0.4);
        }
        .progress-step.completed { background: var(--green); }
        .progress-line { width: 20px; height: 3px; background: var(--gray); border-radius: 2px; flex-shrink: 0; }
        .progress-line.completed { background: var(--green); }

        .main-content { display: none; animation: fadeIn 0.4s ease; }
        .main-content.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        .card-title {
            font-size: 1.2rem; font-weight: 600;
            color: var(--green-dark);
            margin-bottom: 20px; padding-bottom: 12px;
            border-bottom: 2px solid var(--green-light);
        }

        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-weight: 500; color: #555; margin-bottom: 8px; }
        .form-input {
            width: 100%; padding: 12px 16px;
            border: 2px solid #e0e0e0; border-radius: 10px;
            font-size: 16px; font-family: inherit;
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }
        .form-input:focus {
            outline: none; border-color: var(--green);
            box-shadow: 0 0 0 3px rgba(122, 193, 154, 0.2);
        }
        .analyst-display {
            padding: 12px 16px;
            background: linear-gradient(135deg, var(--green-light) 0%, var(--blue-light) 100%);
            border: 2px solid var(--green);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .analyst-name {
            font-size: 1rem;
            font-weight: 500;
            color: var(--green-dark);
        }
        .analyst-display::before {
            content: 'üë§';
            font-size: 1.2rem;
        }

        .btn {
            padding: 12px 28px; border: none; border-radius: 10px;
            font-size: 1rem; font-weight: 500;
            cursor: pointer; transition: all 0.3s ease; font-family: inherit;
            touch-action: manipulation;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--green) 0%, var(--green-dark) 100%);
            color: white;
        }
        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(122, 193, 154, 0.4);
        }
        .btn-secondary { background: var(--gray); color: white; }
        .btn-search {
            background: var(--blue);
            color: white;
            padding: 12px 20px;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn {
            flex: 1; padding: 14px;
            border: 2px solid var(--green); background: white;
            border-radius: 12px; font-size: 1rem; font-weight: 500;
            cursor: pointer; transition: all 0.3s ease; font-family: inherit;
        }
        .tab-btn.active { background: var(--green); color: white; }

        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .checkbox-label {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 16px; border: 2px solid #e0e0e0;
            border-radius: 10px; cursor: pointer;
            transition: all 0.3s ease; background: white; user-select: none;
        }
        .checkbox-label:hover { border-color: var(--green); }
        .checkbox-label input[type="checkbox"] {
            width: 20px; height: 20px; accent-color: var(--green); cursor: pointer;
        }
        .checkbox-label:has(input:checked) {
            border-color: var(--green); background: var(--green-light);
        }
        .disease-with-input {
            flex-wrap: wrap;
        }
        .disease-input {
            width: 100%;
            margin-top: 8px;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        .disease-input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }
        .disease-input:enabled {
            background: white;
            border-color: var(--green);
        }

        .radio-group { display: flex; flex-wrap: wrap; gap: 5px; }
        .radio-btn {
            display: flex; align-items: center; gap: 4px;
            padding: 6px 12px; border: 2px solid #e0e0e0;
            border-radius: 15px; cursor: pointer;
            transition: all 0.2s ease; background: white; user-select: none;
            font-size: 0.85rem;
        }
        .radio-btn:hover { border-color: var(--pink); }
        .radio-btn input[type="radio"] { display: none; }
        .radio-btn .circle {
            width: 14px; height: 14px;
            border: 2px solid #ccc; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .radio-btn .circle::after {
            content: '';
            width: 6px; height: 6px;
            border-radius: 50%;
            background: transparent;
            transition: all 0.2s ease;
        }
        .radio-btn:has(input:checked) {
            border-color: var(--pink); background: var(--pink-light);
        }
        .radio-btn:has(input:checked) .circle {
            border-color: var(--pink-dark);
        }
        .radio-btn:has(input:checked) .circle::after {
            background: var(--pink-dark);
        }

        .two-column {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .body-viewer {
            flex: 0 0 50%;
            max-width: 50%;
        }
        
        .body-image-wrapper {
            position: relative; width: 100%;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px; overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .body-image-container { position: relative; width: 100%; padding-top: 100%; }
        .body-image {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; object-fit: contain;
            display: none;
        }
        .body-image.active { display: block; }
        .hotspot-overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; pointer-events: none;
        }

        .hotspot {
            position: absolute; width: 14px; height: 14px;
            border-radius: 50%; cursor: pointer; pointer-events: auto;
            transition: all 0.2s ease;
            transform: translate(-50%, -50%); z-index: 10;
            display: none;
        }
        .hotspot.visible { display: block; }
        .hotspot-tooltip {
            position: absolute; bottom: calc(100% + 5px); left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85); color: white;
            padding: 4px 10px; border-radius: 4px;
            font-size: 11px; white-space: nowrap;
            opacity: 0; pointer-events: none;
            transition: opacity 0.2s; z-index: 100;
        }
        .hotspot:hover .hotspot-tooltip { opacity: 1; }
        
        .skeleton-hotspot {
            background: rgba(159, 204, 204, 0.85);
            border: 2px solid rgba(102, 136, 142, 1);
        }
        .skeleton-hotspot:hover, .skeleton-hotspot:active {
            transform: translate(-50%, -50%) scale(1.4);
            background: rgba(159, 204, 204, 0.95);
            z-index: 50;
        }
        .skeleton-hotspot.active {
            background: rgba(255, 224, 139, 0.9);
            border-color: rgba(186, 158, 96, 1);
            transform: translate(-50%, -50%) scale(1.5);
            animation: hotspotPulse 1.5s infinite;
            z-index: 50;
        }
        @keyframes hotspotPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 224, 139, 0.6); }
            50% { box-shadow: 0 0 0 10px rgba(255, 224, 139, 0); }
        }
        
        .muscle-hotspot {
            background: rgba(242, 172, 152, 0.85);
            border: 2px solid rgba(198, 117, 102, 1);
        }
        .muscle-hotspot:hover, .muscle-hotspot:active {
            transform: translate(-50%, -50%) scale(1.4);
            background: rgba(242, 172, 152, 0.95);
            z-index: 50;
        }
        .muscle-hotspot.active {
            background: rgba(255, 224, 139, 0.9);
            border-color: rgba(186, 158, 96, 1);
            transform: translate(-50%, -50%) scale(1.5);
            animation: hotspotPulse 1.5s infinite;
            z-index: 50;
        }

        .question-panel {
            flex: 1;
            background: var(--white);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            min-width: 0;
            max-height: 80vh;
            overflow-y: auto;
        }
        .step-indicator {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 15px; color: var(--pink-dark); font-weight: 500;
        }
        .step-nav {
            display: flex; justify-content: space-between;
            margin-top: 18px; padding-top: 12px; border-top: 1px solid #eee;
            gap: 10px;
        }
        
        .inline-form { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin: 8px 0; }
        .inline-form input[type="number"] {
            padding: 8px 10px; border: 2px solid #e0e0e0; border-radius: 6px;
            font-family: inherit; font-size: 16px; width: 70px; text-align: center;
            -webkit-appearance: none;
        }
        .inline-form input[type="number"]:focus {
            outline: none; border-color: var(--green);
        }
        .inline-form span { color: #666; font-size: 0.9rem; }
        
        .assessment-row {
            background: var(--pink-light);
            padding: 10px 12px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .assessment-row-title {
            font-weight: 600;
            color: var(--pink-dark);
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        
        .step-note-input {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid var(--blue-light);
            border-radius: 8px;
            font-family: inherit;
            font-size: 16px;
            margin-top: 10px;
            resize: vertical;
            min-height: 50px;
        }
        .step-note-input:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(159, 204, 204, 0.2);
        }
        .step-note-input::placeholder { color: #aaa; }
        
        .item-note-input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            margin-top: 6px;
            background: rgba(255,255,255,0.8);
        }
        .item-note-input:focus {
            outline: none;
            border-color: var(--blue);
            background: white;
        }
        .item-note-input::placeholder { color: #bbb; font-size: 13px; }

        .muscle-entry {
            background: white;
            border: 2px solid var(--pink-light);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 8px;
        }
        .muscle-entry-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .muscle-name-input {
            flex: 1;
            padding: 6px 10px;
            border: 2px solid var(--pink);
            border-radius: 6px;
            font-size: 16px;
            font-family: inherit;
            max-width: 140px;
        }
        .remove-entry-btn {
            background: var(--pink-dark);
            color: white;
            border: none;
            width: 26px; height: 26px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            flex-shrink: 0;
        }
        .muscle-option-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            flex-wrap: wrap;
        }
        .muscle-option-label {
            font-size: 0.75rem;
            color: #888;
            min-width: 32px;
            flex-shrink: 0;
        }
        .suggest-note-input {
            flex: 1;
            min-width: 80px;
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            font-family: inherit;
        }
        .add-muscle-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed var(--pink);
            background: transparent;
            border-radius: 10px;
            color: var(--pink-dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 0.9rem;
            margin-top: 8px;
        }
        .add-muscle-btn:hover {
            background: var(--pink-light);
            border-style: solid;
        }
        
        .empty-muscle-hint {
            text-align: center;
            padding: 25px 15px;
            color: #999;
            font-size: 0.85rem;
        }

        .coach-section { margin-bottom: 20px; }
        .coach-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        .coach-card {
            background: var(--yellow-light);
            border: 2px solid var(--yellow);
            border-radius: 12px;
            padding: 10px;
        }
        .coach-name { font-weight: 600; margin-bottom: 6px; font-size: 0.9rem; color: #333; }
        .coach-loading {
            grid-column: 1 / -1;
            text-align: center;
            color: #999;
            padding: 20px;
            font-size: 0.9rem;
        }
        .coach-empty {
            grid-column: 1 / -1;
            text-align: center;
            color: #999;
            padding: 15px;
            font-size: 0.85rem;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .half-star-rating {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        .half-star-rating .star-container {
            position: relative;
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        .half-star-rating .star-container .star-bg {
            position: absolute;
            top: 0; left: 0;
            font-size: 22px;
            color: #ddd;
        }
        .half-star-rating .star-container .star-fill {
            position: absolute;
            top: 0; left: 0;
            font-size: 22px;
            color: var(--yellow-dark);
            overflow: hidden;
            width: 0%;
        }
        .half-star-rating .rating-value {
            margin-left: 6px;
            font-size: 0.85rem;
            color: var(--yellow-dark);
            font-weight: 600;
            min-width: 25px;
        }

        .course-suggestion-box {
            background: var(--green-light);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .course-total-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px dashed var(--green);
            flex-wrap: wrap;
        }
        .course-total-row label {
            font-weight: 600;
            color: var(--green-dark);
            font-size: 0.95rem;
        }
        .course-detail-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .course-detail-item {
            background: white;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        .course-detail-item label {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        .course-detail-item .inline-form {
            justify-content: center;
            margin: 0;
        }

        .nav-buttons {
            display: flex; justify-content: space-between;
            margin-top: 20px; padding-top: 15px;
            border-top: 2px solid var(--green-light);
            gap: 10px;
        }

        .toast {
            position: fixed; bottom: 25px; right: 25px;
            background: var(--green-dark); color: white;
            padding: 14px 22px; border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transform: translateY(100px); opacity: 0;
            transition: all 0.3s ease; z-index: 1000;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        
        /* ÊàêÂäüÈ†ÅÈù¢ */
        .success-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }
        .success-overlay.active {
            display: flex;
        }
        .success-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.4s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--green) 0%, var(--green-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 40px;
            color: white;
            box-shadow: 0 10px 30px rgba(122, 193, 154, 0.4);
        }
        .success-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--green-dark);
            margin-bottom: 15px;
        }
        .success-message {
            font-size: 1rem;
            color: #666;
            margin-bottom: 8px;
        }
        .success-details {
            background: var(--green-light);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
            font-size: 0.9rem;
            color: #555;
        }
        .success-details p {
            margin: 6px 0;
        }
        .success-details strong {
            color: var(--green-dark);
        }
        .success-btn {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--green-light); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: var(--green); border-radius: 10px; }
        
        .hint-text {
            font-size: 0.8rem; color: var(--pink-dark);
            font-weight: 500; text-align: center; margin-bottom: 10px;
        }

        .muscle-group-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--pink-dark);
            margin-bottom: 10px;
            padding: 8px 12px;
            background: linear-gradient(135deg, var(--pink-light) 0%, var(--yellow-light) 100%);
            border-radius: 10px;
        }

        .image-hint {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 8px;
            font-size: 0.75rem;
            color: #666;
        }
        .image-hint span {
            padding: 3px 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
        }

        /* ÊúÉÂì°Êü•Ë©¢ÁµêÊûú */
        .member-result {
            background: var(--green-light);
            border: 2px solid var(--green);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        .member-result-title {
            font-weight: 600;
            color: var(--green-dark);
            margin-bottom: 12px;
            font-size: 1rem;
        }
        .member-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .member-info-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .member-info-label {
            display: block;
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 4px;
        }
        .member-info-value {
            font-weight: 600;
            color: var(--green-dark);
            font-size: 0.95rem;
        }
        .first-time-badge {
            background: var(--yellow-light);
            border: 2px solid var(--yellow);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            color: var(--yellow-dark);
            font-weight: 500;
        }
        
        /* ÊôÇÈñìËª∏ÂçÄÂ°ä */
        .timeline-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed var(--green);
        }
        .timeline-title {
            font-weight: 600;
            color: var(--green-dark);
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        .timeline-container {
            background: white;
            border-radius: 12px;
            padding: 20px 15px;
            overflow-x: auto;
        }
        .timeline-track {
            display: flex;
            align-items: flex-start;
            position: relative;
            min-width: max-content;
            padding: 0 10px;
        }
        .timeline-track::before {
            content: '';
            position: absolute;
            top: 12px;
            left: 20px;
            right: 20px;
            height: 3px;
            background: linear-gradient(90deg, var(--green) 0%, var(--blue) 100%);
            border-radius: 2px;
            z-index: 0;
        }
        .timeline-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 20px;
            cursor: pointer;
            position: relative;
            z-index: 1;
            transition: transform 0.2s ease;
        }
        .timeline-node:hover {
            transform: translateY(-3px);
        }
        .timeline-node.active .timeline-dot {
            transform: scale(1.4);
            box-shadow: 0 0 0 4px rgba(122, 193, 154, 0.3);
        }
        .timeline-node.active .timeline-date {
            color: var(--green-dark);
            font-weight: 700;
        }
        .timeline-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--green) 0%, var(--blue) 100%);
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }
        .timeline-dot.new {
            background: linear-gradient(135deg, var(--yellow) 0%, var(--yellow-dark) 100%);
            animation: pulse-new 2s infinite;
        }
        @keyframes pulse-new {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 224, 139, 0.6); }
            50% { box-shadow: 0 0 0 8px rgba(255, 224, 139, 0); }
        }
        .timeline-date {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--blue-dark);
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        .timeline-year {
            font-size: 0.7rem;
            color: #999;
            margin-top: 2px;
        }
        .timeline-time {
            font-size: 0.65rem;
            color: #aaa;
            margin-top: 1px;
        }
        .timeline-node-new .timeline-date {
            color: var(--yellow-dark);
        }
        .timeline-node-new .timeline-year {
            color: var(--yellow-dark);
            font-weight: 500;
        }
        
        /* ÊôÇÈñìËª∏Ë©≥ÊÉÖ */
        .timeline-detail {
            margin-top: 15px;
            min-height: 120px;
            max-height: 400px;
            overflow-y: auto;
        }
        .timeline-detail-hint {
            text-align: center;
            color: #999;
            font-size: 0.85rem;
            padding: 40px 20px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        .detail-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .detail-card.animate-in {
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .detail-header {
            background: linear-gradient(135deg, var(--green) 0%, var(--blue) 100%);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .detail-date {
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }
        .detail-badge {
            background: rgba(255,255,255,0.25);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .detail-body {
            padding: 15px;
        }
        .detail-row {
            margin-bottom: 12px;
        }
        .detail-row:last-child {
            margin-bottom: 0;
        }
        .detail-label {
            display: block;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
            font-weight: 500;
        }
        .detail-value {
            font-weight: 600;
            color: var(--green-dark);
            font-size: 1rem;
        }
        .risk-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .risk-tag {
            background: var(--pink-light);
            color: var(--pink-dark);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .no-data {
            color: #999;
            font-size: 0.85rem;
        }
        .note-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .note-item {
            background: var(--blue-light);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #555;
        }
        .note-title {
            font-weight: 600;
            color: var(--blue-dark);
        }
        
        .search-row {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        .search-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        .search-error {
            background: var(--pink-light);
            border: 2px solid var(--pink);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            color: var(--pink-dark);
            text-align: center;
        }
        
        @media (max-width: 767px) {
            .member-info-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            .member-info-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }
            .member-info-label {
                display: inline;
                margin-bottom: 0;
            }
            .search-row {
                flex-direction: column;
            }
            .search-row .form-group {
                width: 100%;
            }
            .timeline-node {
                padding: 0 15px;
            }
            .timeline-container {
                padding: 15px 10px;
            }
        }

        /* ÂúñÁâá‰∏äÂÇ≥ÂçÄ */
        .upload-section {
            margin-bottom: 20px;
        }
        .upload-section-title {
            font-weight: 600;
            color: var(--blue-dark);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .upload-zone {
            border: 3px dashed var(--blue);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--blue-light);
        }
        .upload-zone:hover {
            border-color: var(--blue-dark);
            background: rgba(159, 204, 204, 0.3);
        }
        .upload-zone.dragover {
            border-color: var(--green);
            background: var(--green-light);
        }
        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .upload-text {
            color: var(--blue-dark);
            font-weight: 500;
            margin-bottom: 5px;
        }
        .upload-hint {
            color: #888;
            font-size: 0.8rem;
        }
        .upload-input {
            display: none;
        }
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            background: #f0f0f0;
        }
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 22px;
            height: 22px;
            background: rgba(198, 117, 102, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .preview-remove:hover {
            background: var(--pink-dark);
        }
        .upload-count {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--blue-dark);
            font-weight: 500;
        }
        .upload-progress {
            margin-top: 10px;
            padding: 10px;
            background: var(--yellow-light);
            border-radius: 8px;
            display: none;
        }
        .upload-progress.active {
            display: block;
        }
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-fill {
            height: 100%;
            background: var(--green);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .loading-overlay.active {
            display: flex;
        }
        .loading-box {
            background: white;
            padding: 30px 50px;
            border-radius: 15px;
            text-align: center;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--green-light);
            border-top-color: var(--green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-text {
            color: var(--green-dark);
            font-weight: 500;
        }

        @media (min-width: 1200px) {
            .container { padding: 20px; }
            .card { padding: 30px; }
            .two-column { gap: 25px; }
            .body-viewer { flex: 0 0 50%; max-width: 50%; }
            .question-panel { padding: 25px; }
        }

        @media (max-width: 991px) {
            .body-viewer { flex: 0 0 45%; max-width: 45%; }
        }

        @media (max-width: 767px) {
            .container { padding: 10px; }
            .header { padding: 10px 15px; justify-content: center; }
            .logo { font-size: 1.1rem; width: 100%; justify-content: center; }
            .progress-container { width: 100%; justify-content: center; }
            .progress-step { width: 30px; height: 30px; font-size: 0.75rem; }
            .progress-line { width: 12px; }
            .card { padding: 15px; border-radius: 15px; }
            .two-column { gap: 12px; }
            .body-viewer { flex: 0 0 42%; max-width: 42%; }
            .hotspot { width: 12px; height: 12px; }
            .question-panel { padding: 12px; max-height: 70vh; }
            .coach-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
            .radio-btn { padding: 5px 8px; font-size: 0.75rem; }
            .radio-btn .circle { width: 12px; height: 12px; }
            .radio-btn .circle::after { width: 5px; height: 5px; }
            .image-hint { font-size: 0.65rem; gap: 10px; }
            .search-row { flex-direction: column; }
            .search-row .form-group { width: 100%; }
            .preview-grid { grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); }
        }

        @media (max-width: 575px) {
            .progress-step { width: 26px; height: 26px; font-size: 0.7rem; }
            .progress-line { width: 8px; }
            .card { padding: 12px; border-radius: 12px; margin-bottom: 10px; }
            .two-column { gap: 10px; }
            .body-viewer { flex: 0 0 40%; max-width: 40%; }
            .hotspot { width: 10px; height: 10px; border-width: 1px; }
            .question-panel { padding: 10px; }
            .btn { padding: 10px 16px; font-size: 0.9rem; }
        }

        @media (max-width: 420px) {
            .body-viewer { flex: 0 0 38%; max-width: 38%; }
            .hotspot { width: 9px; height: 9px; }
            .radio-btn { padding: 4px 6px; font-size: 0.7rem; }
            .radio-btn .circle { width: 10px; height: 10px; }
            .inline-form input[type="number"] { width: 55px; padding: 6px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">Ë°°Èªû</div>
                <span>MOTI 3DÈ´îÊÖãÂàÜÊûê ÂõûÂ†±Ë°®</span>
            </div>
            <div class="progress-container">
                <div class="progress-step active" onclick="goToPage(1)">1</div>
                <div class="progress-line"></div>
                <div class="progress-step" onclick="goToPage(2)">2</div>
                <div class="progress-line"></div>
                <div class="progress-step" onclick="goToPage(3)">3</div>
                <div class="progress-line"></div>
                <div class="progress-step" onclick="goToPage(4)">4</div>
                <div class="progress-line"></div>
                <div class="progress-step" onclick="goToPage(5)">5</div>
            </div>
        </div>

        <!-- Page 1 -->
        <div class="main-content active" id="page1">
            <div class="card">
                <h2 class="card-title">üìã ÊúÉÂì°Ë≥áÊñô</h2>
                <div class="search-row">
                    <div class="form-group"><label class="form-label">ÂßìÂêç *</label><input type="text" class="form-input" id="memberName" placeholder="Ë´ãËº∏ÂÖ•ÊúÉÂì°ÂßìÂêç"></div>
                    <div class="form-group"><label class="form-label">ÈõªË©± *</label><input type="tel" class="form-input" id="memberPhone" placeholder="Ë´ãËº∏ÂÖ•ËÅØÁµ°ÈõªË©±"></div>
                    <button class="btn btn-search" onclick="searchMember()">üîç Êü•Ë©¢</button>
                </div>
                <div id="memberSearchResult"></div>
                <div class="form-group" style="margin-top: 15px;">
                    <label class="form-label">Ê™¢Ê∏¨Êó•ÊúüÊôÇÈñì</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="date" class="form-input" id="assessmentDate" style="flex: 1;">
                        <input type="time" class="form-input" id="assessmentTime" style="flex: 1;">
                    </div>
                </div>
                <div class="form-group" id="analystGroup" style="display: none;">
                    <label class="form-label">ÂàÜÊûêÂ∏´</label>
                    <div class="analyst-display" id="analystDisplay">
                        <span class="analyst-name" id="analystName">ËºâÂÖ•‰∏≠...</span>
                        <input type="hidden" id="analystLineId" value="">
                    </div>
                </div>
            </div>
            <div class="nav-buttons"><div></div><button class="btn btn-primary" onclick="nextPage()">‰∏ã‰∏ÄÊ≠• ‚Üí</button></div>
        </div>

        <!-- Page 2 -->
        <div class="main-content" id="page2">
            <div class="card">
                <h2 class="card-title">üë§ ÂÄã‰∫∫Ë≥áÊñô</h2>
                <div class="form-group">
                    <label class="form-label">ÊúüÊúõÁõÆÊ®ôÔºàÂèØË§áÈÅ∏Ôºâ</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="goals" value="Ê∏õËÑÇ"><span>Ê∏õËÑÇ</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="goals" value="Â¢ûËÇå"><span>Â¢ûËÇå</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="goals" value="ÊîπÂñÑÈ´îÊÖã"><span>ÊîπÂñÑÈ´îÊÖã</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="goals" value="ÊîπÂñÑÁó†Áóõ"><span>ÊîπÂñÑÁó†Áóõ</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="goals" value="Ë™øÊï¥ÂßøÂã¢"><span>Ë™øÊï¥ÂßøÂã¢</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="goals" value="Ë°ìÂæå/Áî¢ÂæåÊÅ¢Âæ©"><span>Ë°ìÂæå/Áî¢ÂæåÊÅ¢Âæ©</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="goals" value="Êó•Â∏∏ÂÅ•Â∫∑Á∂≠ÊåÅ"><span>Êó•Â∏∏ÂÅ•Â∫∑Á∂≠ÊåÅ</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ÁñæÁóÖÂè≤ÔºàÂèØË§áÈÅ∏Ôºâ</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÂøÉËáüÁóÖ"><span>ÂøÉËáüÁóÖ</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÂøÉÁµûÁóõ"><span>ÂøÉÁµûÁóõ</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="Á≥ñÂ∞øÁóÖ"><span>Á≥ñÂ∞øÁóÖ</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÁñùÊ∞£/ËÑ´ËÖ∏"><span>ÁñùÊ∞£/ËÑ´ËÖ∏</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="È´òË°ÄÂ£ì"><span>È´òË°ÄÂ£ì</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="Ê∞£Âñò"><span>Ê∞£Âñò</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="Ë≤ßË°Ä"><span>Ë≤ßË°Ä</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="Áô≤Áôá"><span>Áô≤Áôá</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="Áî≤ÁãÄËÖ∫ÂïèÈ°å"><span>Áî≤ÁãÄËÖ∫ÂïèÈ°å</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÈùúËÑàÁò§"><span>ÈùúËÑàÁò§</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÊÉ°ÊÄßËÖ´Áò§"><span>ÊÉ°ÊÄßËÖ´Áò§</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="Ê§éÈñìÁõ§Á™ÅÂá∫"><span>Ê§éÈñìÁõ§Á™ÅÂá∫</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÁøíÊÖ£ÊÄßËÑ´Ëáº"><span>ÁøíÊÖ£ÊÄßËÑ´Ëáº</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ËÑäÊ§éÊªëËÑ´"><span>ËÑäÊ§éÊªëËÑ´</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="È™®Ë≥™ÁñèÈ¨ÜÁóá"><span>È™®Ë≥™ÁñèÈ¨ÜÁóá</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÁóõÈ¢®/È¢®Êøï"><span>ÁóõÈ¢®/È¢®Êøï</span></label>
                        <label class="checkbox-label disease-with-input"><input type="checkbox" name="disease" value="ÈóúÁØÄÂïèÈ°å" onchange="toggleDiseaseInput('jointInput', this)"><span>ÈóúÁØÄÂïèÈ°å</span><input type="text" id="jointInput" class="disease-input" placeholder="Ë´ãË™™Êòé" disabled></label>
                        <label class="checkbox-label disease-with-input"><input type="checkbox" name="disease" value="ËÑäÊ§éÂïèÈ°å" onchange="toggleDiseaseInput('spineInput', this)"><span>ËÑäÊ§éÂïèÈ°å</span><input type="text" id="spineInput" class="disease-input" placeholder="Ë´ãË™™Êòé" disabled></label>
                        <label class="checkbox-label disease-with-input"><input type="checkbox" name="disease" value="ÂÖ∂‰ªñ" onchange="toggleDiseaseInput('otherDiseaseInput', this)"><span>ÂÖ∂‰ªñ</span><input type="text" id="otherDiseaseInput" class="disease-input" placeholder="Ë´ãË™™Êòé" disabled></label>
                        <label class="checkbox-label"><input type="checkbox" name="disease" value="ÁÑ°"><span>ÁÑ°</span></label>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">ÂÇôË®ªÔºàÂèóÂÇ∑/ÊâãË°ìÂè≤/ÁîüÊ¥ªÁøíÊÖ£/ÈÜ´ÁîüÂª∫Ë≠∞Ôºâ</label><textarea class="form-input" id="notes" rows="2" placeholder="Ë´ãÂ°´ÂØ´Áõ∏ÈóúÂÇôË®ª"></textarea></div>
                <div class="form-group">
                    <label class="form-label">ÈÅéÂéªÈÅãÂãïÁ∂ìÈ©ó</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="exercise" value="Êúâ" onchange="toggleExerciseDetails()"><span>Êúâ</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="exercise" value="ÁÑ°"><span>ÁÑ°</span></label>
                    </div>
                    <div id="exerciseDetails" style="display: none; margin-top: 12px;">
                        <input type="text" class="form-input" id="exerciseType" placeholder="ÈÅãÂãïÈ†ÖÁõÆ" style="margin-bottom: 8px;">
                        <input type="text" class="form-input" id="exerciseDuration" placeholder="Á∂≠ÊåÅÊôÇÈñì">
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevPage()">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                <button class="btn btn-primary" onclick="nextPage()">‰∏ã‰∏ÄÊ≠• ‚Üí</button>
            </div>
        </div>

        <!-- Page 3: È™®È™ºË©ï‰º∞ (‰øùÊåÅÂéüÊ®£) -->
        <div class="main-content" id="page3">
            <div class="card">
                <h2 class="card-title">ü¶¥ È™®È™ºÊéíÂàóË©ï‰º∞</h2>
                <div class="two-column">
                    <div class="body-viewer">
                        <div class="body-image-wrapper">
                            <div class="body-image-container">
                                <img src="" alt="Ê≠£Èù¢+ÂÅ¥Èù¢" class="body-image active" id="skeletonFS">
                                <img src="" alt="Ê≠£Èù¢+ËÉåÈù¢" class="body-image" id="skeletonFB">
                                <div class="hotspot-overlay" id="skeletonOverlay"></div>
                            </div>
                        </div>
                        <div class="image-hint" id="imageHint">
                            <span>‚Üê Ê≠£Èù¢</span>
                            <span id="rightHint">ÂÅ¥Èù¢ ‚Üí</span>
                        </div>
                    </div>
                    <div class="question-panel" id="skeletonPanel">
                        <div class="step-indicator"><span>Ê≠•È©ü</span><span id="currentStepNum">0</span><span>/ 10</span></div>
                        
                        <div class="skeleton-step active" data-step="0">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">È¢®Èö™ÊéíÂêç</h3>
                            <p style="margin-bottom: 10px; color: #666; font-size: 0.85rem;">Ë´ãÂ°´ÂØ´Ââç‰∏âÈ†ÖÊúÄÈúÄË¶ÅÈóúÊ≥®ÁöÑÈ¢®Èö™Ôºö</p>
                            <div class="form-group"><label class="form-label">Á¨¨‰∏ÄÈ¢®Èö™</label><input type="text" class="form-input" id="risk1" placeholder="Ë´ãËº∏ÂÖ•Á¨¨‰∏ÄÈ¢®Èö™"></div>
                            <div class="form-group"><label class="form-label">Á¨¨‰∫åÈ¢®Èö™</label><input type="text" class="form-input" id="risk2" placeholder="Ë´ãËº∏ÂÖ•Á¨¨‰∫åÈ¢®Èö™"></div>
                            <div class="form-group"><label class="form-label">Á¨¨‰∏âÈ¢®Èö™</label><input type="text" class="form-input" id="risk3" placeholder="Ë´ãËº∏ÂÖ•Á¨¨‰∏âÈ¢®Èö™"></div>
                        </div>

                        <div class="skeleton-step" data-step="1">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ËÑäÊ§éÂÅ¥ÂΩé</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ÊòØÂê¶ÊúâËÑäÊ§éÂÅ¥ÂΩé</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="scoliosis" value="ÊòØ"><span class="circle"></span><span>ÊòØ</span></label>
                                    <label class="radio-btn"><input type="radio" name="scoliosis" value="Âê¶"><span class="circle"></span><span>Âê¶</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="scoliosisNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ËÉ∏Ê§é</div>
                                <div class="inline-form"><input type="number" id="thoracicCurveDegree" placeholder="0"><span>Â∫¶</span></div>
                                <div class="radio-group" style="margin-top: 6px;">
                                    <label class="radio-btn"><input type="radio" name="thoracicCurve" value="ÂêëÂ∑¶"><span class="circle"></span><span>ÂêëÂ∑¶</span></label>
                                    <label class="radio-btn"><input type="radio" name="thoracicCurve" value="ÂêëÂè≥"><span class="circle"></span><span>ÂêëÂè≥</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="thoracicCurveNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ËÖ∞Ê§é</div>
                                <div class="inline-form"><input type="number" id="lumbarCurveDegree" placeholder="0"><span>Â∫¶</span></div>
                                <div class="radio-group" style="margin-top: 6px;">
                                    <label class="radio-btn"><input type="radio" name="lumbarCurve" value="ÂêëÂ∑¶"><span class="circle"></span><span>ÂêëÂ∑¶</span></label>
                                    <label class="radio-btn"><input type="radio" name="lumbarCurve" value="ÂêëÂè≥"><span class="circle"></span><span>ÂêëÂè≥</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="lumbarCurveNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="2">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">È†∏Ê§éË©ï‰º∞ÔºàÊ®ôÊ∫ñ11Â∫¶Ôºâ</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">È†∏Ê§éÁãÄÊÖã</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="cervical" value="ÂâçÂºï"><span class="circle"></span><span>ÂâçÂºï</span></label>
                                    <label class="radio-btn"><input type="radio" name="cervical" value="Âæå‰º∏"><span class="circle"></span><span>Âæå‰º∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="cervical" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <div class="inline-form" style="margin-top: 8px;"><input type="number" id="cervicalDegree" placeholder="11"><span>Â∫¶</span></div>
                                <input type="text" class="item-note-input" id="cervicalNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="3">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ËÉ∏Ê§éË©ï‰º∞ÔºàÊ®ôÊ∫ñ36Â∫¶Ôºâ</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ËÉ∏Ê§éÁãÄÊÖã</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="thoracic" value="ÂâçÂá∏"><span class="circle"></span><span>ÂâçÂá∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="thoracic" value="ÂæåÂá∏"><span class="circle"></span><span>ÂæåÂá∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="thoracic" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <div class="inline-form" style="margin-top: 8px;"><input type="number" id="thoracicDegree" placeholder="36"><span>Â∫¶</span></div>
                                <input type="text" class="item-note-input" id="thoracicNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="4">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ËÖ∞Ê§éË©ï‰º∞ÔºàÊ®ôÊ∫ñ35Â∫¶Ôºâ</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ËÖ∞Ê§éÁãÄÊÖã</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="lumbar" value="ÂâçÂá∏"><span class="circle"></span><span>ÂâçÂá∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="lumbar" value="ÂæåÂá∏"><span class="circle"></span><span>ÂæåÂá∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="lumbar" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <div class="inline-form" style="margin-top: 8px;"><input type="number" id="lumbarDegree" placeholder="35"><span>Â∫¶</span></div>
                                <input type="text" class="item-note-input" id="lumbarNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="5">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">È™®ÁõÜË©ï‰º∞</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">1. ÂâçÂæåÂÇæ</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="pelvisTilt" value="ÂâçÂÇæ"><span class="circle"></span><span>ÂâçÂÇæ</span></label>
                                    <label class="radio-btn"><input type="radio" name="pelvisTilt" value="ÂæåÂÇæ"><span class="circle"></span><span>ÂæåÂÇæ</span></label>
                                    <label class="radio-btn"><input type="radio" name="pelvisTilt" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <div class="inline-form" style="margin-top: 6px;"><input type="number" id="pelvisTiltDegree" placeholder="0"><span>Â∫¶</span></div>
                                <input type="text" class="item-note-input" id="pelvisTiltNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">2. Â∑¶Âè≥È´ò‰Ωé</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="pelvisSide" value="Â∑¶ÂÅ¥"><span class="circle"></span><span>Â∑¶ÂÅ¥</span></label>
                                    <label class="radio-btn"><input type="radio" name="pelvisSide" value="Âè≥ÂÅ¥"><span class="circle"></span><span>Âè≥ÂÅ¥</span></label>
                                </div>
                                <div class="inline-form" style="margin-top: 6px;"><input type="number" id="pelvisSideDegree" placeholder="0"><span>Â∫¶</span></div>
                                <div class="radio-group" style="margin-top: 6px;">
                                    <label class="radio-btn"><input type="radio" name="pelvisUpDown" value="‰∏äÊèê"><span class="circle"></span><span>‰∏äÊèê</span></label>
                                    <label class="radio-btn"><input type="radio" name="pelvisUpDown" value="‰∏ãÈôç"><span class="circle"></span><span>‰∏ãÈôç</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="pelvisSideNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">3. ÊóãËΩâ</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="pelvisRotation" value="ÂêëÂ∑¶ÊóãËΩâ"><span class="circle"></span><span>ÂêëÂ∑¶ÊóãËΩâ</span></label>
                                    <label class="radio-btn"><input type="radio" name="pelvisRotation" value="ÂêëÂè≥ÊóãËΩâ"><span class="circle"></span><span>ÂêëÂè≥ÊóãËΩâ</span></label>
                                    <label class="radio-btn"><input type="radio" name="pelvisRotation" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="pelvisRotationNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">4. ÂäüËÉΩÊÄßÂæåÂÇæ</div>
                                <label class="checkbox-label" style="padding: 6px 10px; display: inline-flex;"><input type="checkbox" id="functionalTilt"><span>ÂèØËÉΩÂäüËÉΩÊÄßÂæåÂÇæ</span></label>
                                <input type="text" class="item-note-input" id="functionalTiltNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="6">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ËÜùËìãË©ï‰º∞</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">1. Â∑¶ËÖ≥</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="leftKnee" value="ÂÖßÁøª(XÂûã)"><span class="circle"></span><span>ÂÖßÁøª(XÂûã)</span></label>
                                    <label class="radio-btn"><input type="radio" name="leftKnee" value="Â§ñÁøª(OÂûã)"><span class="circle"></span><span>Â§ñÁøª(OÂûã)</span></label>
                                    <label class="radio-btn"><input type="radio" name="leftKnee" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <div class="inline-form" style="margin-top: 6px;"><input type="number" id="leftKneeDegree" placeholder="0"><span>Â∫¶</span></div>
                                <input type="text" class="item-note-input" id="leftKneeNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">2. Âè≥ËÖ≥</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="rightKnee" value="ÂÖßÁøª(XÂûã)"><span class="circle"></span><span>ÂÖßÁøª(XÂûã)</span></label>
                                    <label class="radio-btn"><input type="radio" name="rightKnee" value="Â§ñÁøª(OÂûã)"><span class="circle"></span><span>Â§ñÁøª(OÂûã)</span></label>
                                    <label class="radio-btn"><input type="radio" name="rightKnee" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <div class="inline-form" style="margin-top: 6px;"><input type="number" id="rightKneeDegree" placeholder="0"><span>Â∫¶</span></div>
                                <input type="text" class="item-note-input" id="rightKneeNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="7">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ËÖ≥Ë∏ùË©ï‰º∞</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">1. Ë∂≥ÂºìÁãÄÊÖã</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="arch" value="ÂÖßÁøª(È´òË∂≥Âºì)"><span class="circle"></span><span>ÂÖßÁøª(È´òË∂≥Âºì)</span></label>
                                    <label class="radio-btn"><input type="radio" name="arch" value="Â§ñÁøª(‰ΩéË∂≥Âºì)"><span class="circle"></span><span>Â§ñÁøª(‰ΩéË∂≥Âºì)</span></label>
                                    <label class="radio-btn"><input type="radio" name="arch" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="archNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">2. Ë∂≥ÈÉ®ÊóãËΩâ</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="footRotation" value="Â§ñÊóã(Â§ñÂÖ´)"><span class="circle"></span><span>Â§ñÊóã(Â§ñÂÖ´)</span></label>
                                    <label class="radio-btn"><input type="radio" name="footRotation" value="ÂÖßÊóã(ÂÖßÂÖ´)"><span class="circle"></span><span>ÂÖßÊóã(ÂÖßÂÖ´)</span></label>
                                    <label class="radio-btn"><input type="radio" name="footRotation" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="footRotationNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="8">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ÈóúÁØÄÂäüËÉΩ - ËÇ©ÈóúÁØÄ</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">1. ËÅ≥ËÇ©</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="shrug" value="ÊòØ"><span class="circle"></span><span>ÊòØ</span></label>
                                    <label class="radio-btn"><input type="radio" name="shrug" value="Âê¶"><span class="circle"></span><span>Âê¶</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="shrugNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">2. ÂúìËÇ©</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="roundShoulder" value="ÊòØ"><span class="circle"></span><span>ÊòØ</span></label>
                                    <label class="radio-btn"><input type="radio" name="roundShoulder" value="Âê¶"><span class="circle"></span><span>Âê¶</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="roundShoulderNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">3. ËÇ©ËÉõÈ™®</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="scapula" value="ÁøºÁãÄËÇ©"><span class="circle"></span><span>ÁøºÁãÄËÇ©</span></label>
                                    <label class="radio-btn"><input type="radio" name="scapula" value="‰∏äËø¥ÊóãÁï∞Â∏∏"><span class="circle"></span><span>‰∏äËø¥ÊóãÁï∞Â∏∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="scapula" value="‰∏ãËø¥ÊóãÁï∞Â∏∏"><span class="circle"></span><span>‰∏ãËø¥ÊóãÁï∞Â∏∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="scapula" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="scapulaNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">4. ËÇ±È™®</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="humerus" value="ÂâçÊóã"><span class="circle"></span><span>ÂâçÊóã</span></label>
                                    <label class="radio-btn"><input type="radio" name="humerus" value="ÂÖßÊóã"><span class="circle"></span><span>ÂÖßÊóã</span></label>
                                    <label class="radio-btn"><input type="radio" name="humerus" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="humerusNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="9">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ÈóúÁØÄÂäüËÉΩ - È´ñ/ËÜù/Ë∏ù</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">È´ñÈóúÁØÄ</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="hip" value="ÂÖßÊóã"><span class="circle"></span><span>ÂÖßÊóã</span></label>
                                    <label class="radio-btn"><input type="radio" name="hip" value="Â§ñÊóã"><span class="circle"></span><span>Â§ñÊóã</span></label>
                                    <label class="radio-btn"><input type="radio" name="hip" value="Ê≠£Â∏∏"><span class="circle"></span><span>Ê≠£Â∏∏</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="hipNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ËÜùÈóúÁØÄ - ÂãïÊÖãÊòØÂê¶‰∏çÁ©©</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="kneeStability" value="ÊòØ"><span class="circle"></span><span>ÊòØ</span></label>
                                    <label class="radio-btn"><input type="radio" name="kneeStability" value="Âê¶"><span class="circle"></span><span>Âê¶</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="kneeStabilityNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">Ë∏ùÈóúÁØÄ - ÂãïÊÖãÊòØÂê¶‰∏çÁ©©</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="ankleStability" value="ÊòØ"><span class="circle"></span><span>ÊòØ</span></label>
                                    <label class="radio-btn"><input type="radio" name="ankleStability" value="Âê¶"><span class="circle"></span><span>Âê¶</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="ankleStabilityNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="skeleton-step" data-step="10">
                            <h3 style="margin-bottom: 10px; color: var(--pink-dark); font-size: 1rem;">ÂëºÂê∏ÂäüËÉΩË©ï‰º∞</h3>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ÊòØÂê¶Áü≠Ê∑∫</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="breathingShallow" value="ÊòØ"><span class="circle"></span><span>ÊòØ</span></label>
                                    <label class="radio-btn"><input type="radio" name="breathingShallow" value="Âê¶"><span class="circle"></span><span>Âê¶</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="breathingShallowNote" placeholder="ÂÇôË®ª...">
                            </div>
                            <div class="assessment-row">
                                <div class="assessment-row-title">ÂëºÂê∏Ê®°Âºè</div>
                                <div class="radio-group">
                                    <label class="radio-btn"><input type="radio" name="breathingPattern" value="ËÇ©È†∏"><span class="circle"></span><span>ËÇ©È†∏</span></label>
                                    <label class="radio-btn"><input type="radio" name="breathingPattern" value="ËÉ∏ËÖî"><span class="circle"></span><span>ËÉ∏ËÖî</span></label>
                                    <label class="radio-btn"><input type="radio" name="breathingPattern" value="ËÖπËÖî"><span class="circle"></span><span>ËÖπËÖî</span></label>
                                    <label class="radio-btn"><input type="radio" name="breathingPattern" value="ÂàùÊ≠•Ê≤íÊúâÂ§™Â§ßÂïèÈ°å"><span class="circle"></span><span>ÂàùÊ≠•Ê≤íÊúâÂ§™Â§ßÂïèÈ°å</span></label>
                                </div>
                                <input type="text" class="item-note-input" id="breathingPatternNote" placeholder="ÂÇôË®ª...">
                            </div>
                        </div>

                        <div class="step-nav">
                            <button class="btn btn-secondary" id="prevStepBtn" onclick="prevSkeletonStep()">‚Üê ‰∏ä‰∏ÄÈ°å</button>
                            <button class="btn btn-primary" id="nextStepBtn" onclick="nextSkeletonStep()">‰∏ã‰∏ÄÈ°å ‚Üí</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevPage()">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                <button class="btn btn-primary" onclick="nextPage()">‰∏ã‰∏ÄÊ≠• ‚Üí</button>
            </div>
        </div>

        <!-- Page 4: ËÇåËÇâË©ï‰º∞ (‰øùÊåÅÂéüÊ®£) -->
        <div class="main-content" id="page4">
            <div class="card">
                <h2 class="card-title">üí™ ËÇåËÇâÂºµÂäõÂ†±Âëä</h2>
                <div class="hint-text">üí° Â∑¶ÂÅ¥ÁÇ∫Ê≠£Èù¢ | Âè≥ÂÅ¥ÁÇ∫ËÉåÈù¢</div>
                <div class="two-column">
                    <div class="body-viewer">
                        <div class="body-image-wrapper" style="background: linear-gradient(135deg, var(--pink-light) 0%, var(--yellow-light) 100%);">
                            <div class="body-image-container">
                                <img src="" alt="ËÇåËÇâÂúñ" class="body-image active" id="muscleImage">
                                <div class="hotspot-overlay" id="muscleOverlay"></div>
                            </div>
                        </div>
                    </div>
                    <div class="question-panel" id="musclePanel">
                        <div class="step-indicator"><span>ËÇåÁæ§</span><span id="currentMuscleStep">1</span><span>/ 6</span></div>
                        <div class="muscle-step active" data-group="shoulder"><div class="muscle-group-title">üîµ ËÇ©ËÜÄËÇåÁæ§</div><div id="shoulderMuscles"><div class="empty-muscle-hint">Â∞öÊú™Êñ∞Â¢ûËÇåËÇâÔºåË´ãÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢û</div></div><button class="add-muscle-btn" onclick="addMuscleEntry('shoulderMuscles', 'shoulder')">+ Êñ∞Â¢ûËÇåËÇâ</button></div>
                        <div class="muscle-step" data-group="chest"><div class="muscle-group-title">üü† ËÉ∏ÈÉ®ËÇåÁæ§</div><div id="chestMuscles"><div class="empty-muscle-hint">Â∞öÊú™Êñ∞Â¢ûËÇåËÇâÔºåË´ãÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢û</div></div><button class="add-muscle-btn" onclick="addMuscleEntry('chestMuscles', 'chest')">+ Êñ∞Â¢ûËÇåËÇâ</button></div>
                        <div class="muscle-step" data-group="back"><div class="muscle-group-title">üü¢ ËÉåÈÉ®ËÇåÁæ§</div><div id="backMuscles"><div class="empty-muscle-hint">Â∞öÊú™Êñ∞Â¢ûËÇåËÇâÔºåË´ãÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢û</div></div><button class="add-muscle-btn" onclick="addMuscleEntry('backMuscles', 'back')">+ Êñ∞Â¢ûËÇåËÇâ</button></div>
                        <div class="muscle-step" data-group="core"><div class="muscle-group-title">üü° Ê†∏ÂøÉËÇåÁæ§</div><div id="coreMuscles"><div class="empty-muscle-hint">Â∞öÊú™Êñ∞Â¢ûËÇåËÇâÔºåË´ãÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢û</div></div><button class="add-muscle-btn" onclick="addMuscleEntry('coreMuscles', 'core')">+ Êñ∞Â¢ûËÇåËÇâ</button></div>
                        <div class="muscle-step" data-group="glute"><div class="muscle-group-title">üü£ ËáÄÈÉ®ËÇåÁæ§</div><div id="gluteMuscles"><div class="empty-muscle-hint">Â∞öÊú™Êñ∞Â¢ûËÇåËÇâÔºåË´ãÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢û</div></div><button class="add-muscle-btn" onclick="addMuscleEntry('gluteMuscles', 'glute')">+ Êñ∞Â¢ûËÇåËÇâ</button></div>
                        <div class="muscle-step" data-group="leg"><div class="muscle-group-title">üî¥ ËÖøÈÉ®ËÇåÁæ§</div><div id="legMuscles"><div class="empty-muscle-hint">Â∞öÊú™Êñ∞Â¢ûËÇåËÇâÔºåË´ãÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢û</div></div><button class="add-muscle-btn" onclick="addMuscleEntry('legMuscles', 'leg')">+ Êñ∞Â¢ûËÇåËÇâ</button></div>
                        <div class="step-nav">
                            <button class="btn btn-secondary" id="prevMuscleBtn" onclick="prevMuscleStep()">‚Üê ‰∏ä‰∏ÄÁµÑ</button>
                            <button class="btn btn-primary" id="nextMuscleBtn" onclick="nextMuscleStep()">‰∏ã‰∏ÄÁµÑ ‚Üí</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevPage()">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                <button class="btn btn-primary" onclick="nextPage()">‰∏ã‰∏ÄÊ≠• ‚Üí</button>
            </div>
        </div>

        <!-- Page 5: ÂàÜÊûêÂ∏´Âª∫Ë≠∞ + ÂúñÁâá‰∏äÂÇ≥ -->
        <div class="main-content" id="page5">
            <div class="card">
                <h2 class="card-title">üìù ÂàÜÊûêÂ∏´Âª∫Ë≠∞</h2>
                <div class="form-group"><label class="form-label">Áü≠ÊúüÁõÆÊ®ô</label><textarea class="form-input" id="shortTermGoal" rows="2" placeholder="Ë´ãÂ°´ÂØ´Áü≠ÊúüË®ìÁ∑¥ÁõÆÊ®ô"></textarea></div>
                <div class="form-group">
                    <label class="form-label">Âª∫Ë≠∞Ë™≤Á®ãÔºà6ÂÄãÊúàÂÖßÔºâ</label>
                    <div class="course-suggestion-box">
                        <div class="course-total-row"><label>Á∏ΩÂ†ÇÊï∏</label><div class="inline-form" style="margin: 0;"><input type="number" id="totalCourses" placeholder="0" style="width: 80px;" readonly><span>Â†Ç</span></div></div>
                        <div class="course-detail-row">
                            <div class="course-detail-item"><label>ÈáçË®ì</label><div class="inline-form"><input type="number" id="weightTraining" placeholder="0" oninput="updateTotalCourses()"><span>Â†Ç</span></div></div>
                            <div class="course-detail-item"><label>ÁöÆÊãâÊèêÊñØ</label><div class="inline-form"><input type="number" id="pilatesTraining" placeholder="0" oninput="updateTotalCourses()"><span>Â†Ç</span></div></div>
                            <div class="course-detail-item"><label>‰º∏Â±ï</label><div class="inline-form"><input type="number" id="stretchTraining" placeholder="0" oninput="updateTotalCourses()"><span>Â†Ç</span></div></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ÂÆ¢Êà∂ÊòØÂê¶Ê∏ÖÊ•öÊñπÊ°àÂª∫Ë≠∞?</label>
                    <div class="radio-group">
                        <label class="radio-btn"><input type="radio" name="clientUnderstand" value="ÊòØ"><span class="circle"></span><span>ÊòØ</span></label>
                        <label class="radio-btn"><input type="radio" name="clientUnderstand" value="Âê¶"><span class="circle"></span><span>Âê¶</span></label>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Âª∫Ë≠∞ÂäüËÉΩË®ìÁ∑¥</label><textarea class="form-input" id="functionalTraining" rows="2" placeholder="Ë´ãÂ°´ÂØ´Âª∫Ë≠∞ÁöÑÂäüËÉΩË®ìÁ∑¥"></textarea></div>
                <div class="form-group"><label class="form-label">Âª∫Ë≠∞Á≠ãËÜúÊîæÈ¨Ü</label><textarea class="form-input" id="fasciaRelease" rows="2" placeholder="Ë´ãÂ°´ÂØ´Âª∫Ë≠∞ÁöÑÁ≠ãËÜúÊîæÈ¨Ü"></textarea></div>
                <div class="coach-section">
                    <label class="form-label">Âª∫Ë≠∞ÊïôÁ∑¥Ôºà0ÊòüÂö¥Á¶ÅÂÆâÊéíÔºå0.5ÊòüËµ∑ÂèØÂÆâÊéíÔºå3ÊòüÊúÄÊé®Ëñ¶Ôºâ</label>
                    <h4 style="color: var(--green-dark); margin: 10px 0 6px;">ÈáçË®ìÊïôÁ∑¥</h4>
                    <div class="coach-grid" id="weightCoaches">
                        <div class="coach-loading">ËºâÂÖ•‰∏≠...</div>
                    </div>
                    <h4 style="color: var(--green-dark); margin: 10px 0 6px;">ÁöÆÊãâÊèêÊñØÊïôÁ∑¥</h4>
                    <div class="coach-grid" id="pilatesCoaches">
                        <div class="coach-loading">ËºâÂÖ•‰∏≠...</div>
                    </div>
                    <h4 style="color: var(--green-dark); margin: 10px 0 6px;">‰º∏Â±ïËÄÅÂ∏´</h4>
                    <div class="coach-grid" id="stretchCoaches">
                        <div class="coach-loading">ËºâÂÖ•‰∏≠...</div>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Ê≥®ÊÑè‰∫ãÈ†Ö</label><textarea class="form-input" id="precautions" rows="2" placeholder="Ë´ãÂ°´ÂØ´Ê≥®ÊÑè‰∫ãÈ†Ö"></textarea></div>
                <div class="form-group"><label class="form-label">ÂÆ¢ÊúçÂçîÂä©</label><textarea class="form-input" id="serviceNotes" rows="2" placeholder="Ë´ãÂ°´ÂØ´ÈúÄË¶ÅÂÆ¢ÊúçÂçîÂä©ÁöÑ‰∫ãÈ†Ö"></textarea></div>
            </div>

            <!-- ÂúñÁâá‰∏äÂÇ≥ÂçÄ -->
            <div class="card">
                <h2 class="card-title">üì∏ Ê™¢Ê∏¨ÁÖßÁâá‰∏äÂÇ≥</h2>
                
                <!-- Moti AI ÁÖßÁâá -->
                <div class="upload-section">
                    <div class="upload-section-title">ü§ñ Moti AI ÁÖßÁâáÔºàÊúÄÂ§ö 20 ÂºµÔºâ</div>
                    <div class="upload-zone" id="motiUploadZone" onclick="document.getElementById('motiInput').click()">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">ÈªûÊìäÊàñÊãñÊãâ‰∏äÂÇ≥ÁÖßÁâá</div>
                        <div class="upload-hint">ÊîØÊè¥ JPG„ÄÅPNGÔºåÊØèÂºµËá™ÂãïÂ£ìÁ∏Æ</div>
                    </div>
                    <input type="file" id="motiInput" class="upload-input" multiple accept="image/*" onchange="handleFileSelect(event, 'moti')">
                    <div class="preview-grid" id="motiPreview"></div>
                    <div class="upload-count" id="motiCount">Â∑≤ÈÅ∏Êìá 0 / 20 Âºµ</div>
                </div>

                <!-- InBody ÁÖßÁâá -->
                <div class="upload-section">
                    <div class="upload-section-title">üìä InBody ÁÖßÁâáÔºà1 ÂºµÔºâ</div>
                    <div class="upload-zone" id="inbodyUploadZone" onclick="document.getElementById('inbodyInput').click()">
                        <div class="upload-icon">üìã</div>
                        <div class="upload-text">ÈªûÊìäÊàñÊãñÊãâ‰∏äÂÇ≥ÁÖßÁâá</div>
                        <div class="upload-hint">ÊîØÊè¥ JPG„ÄÅPNG</div>
                    </div>
                    <input type="file" id="inbodyInput" class="upload-input" accept="image/*" onchange="handleFileSelect(event, 'inbody')">
                    <div class="preview-grid" id="inbodyPreview"></div>
                    <div class="upload-count" id="inbodyCount">Â∑≤ÈÅ∏Êìá 0 / 1 Âºµ</div>
                </div>

                <div class="upload-progress" id="uploadProgress">
                    <div style="font-weight: 500; color: var(--yellow-dark);">‚è≥ Ê≠£Âú®‰∏äÂÇ≥ÁÖßÁâá...</div>
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div id="progressText" style="margin-top: 5px; font-size: 0.85rem; color: #666;">0%</div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevPage()">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                <button class="btn btn-primary" id="submitBtn" onclick="submitAssessment()">Êèê‰∫§Ë©ï‰º∞Â†±Âëä ‚úì</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-box">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">ËôïÁêÜ‰∏≠...</div>
        </div>
    </div>

    <div class="toast" id="toast"></div>
    
    <!-- ÊàêÂäüÈ†ÅÈù¢ -->
    <div class="success-overlay" id="successOverlay">
        <div class="success-box">
            <div class="success-icon">‚úì</div>
            <h2 class="success-title">Êèê‰∫§ÊàêÂäüÔºÅ</h2>
            <p class="success-message">Ë©ï‰º∞Â†±ÂëäÂ∑≤ÊàêÂäüÊèê‰∫§</p>
            <p class="success-message">ÂúñÁâáÂ∑≤ÂÆåÊàê‰∏äÂÇ≥</p>
            <div class="success-details" id="successDetails"></div>
            <button class="btn btn-primary success-btn" onclick="closeSuccessAndReset()">ÂÆåÊàêÔºåÈñãÂßãÊñ∞Ë©ï‰º∞</button>
            <button class="btn btn-secondary success-btn" onclick="closeSuccess()" style="margin-top: 10px;">ÈóúÈñâ</button>
        </div>
    </div>

    <script>
        // ==================== Ë®≠ÂÆöÂçÄÔºàË´ãÂ°´ÂÖ•Ôºâ ====================
        var CONFIG = {
            // „ÄêË´ãÂ°´ÂÖ•„ÄëLIFF IDÔºàÂæû LINE Developers Console ÂèñÂæóÔºâ
            LIFF_ID: '2008660081-Pw8Zcb6h',
            
            // „ÄêË´ãÂ°´ÂÖ•„ÄëMake Webhook URLÔºàÊü•Ë©¢ÊúÉÂì° + Êèê‰∫§Ë©ï‰º∞Ôºâ
            MAKE_WEBHOOK_URL: 'https://hook.us2.make.com/vsk129ur2xv54sscfoflt5aacil4mws2',
            
            // „ÄêË´ãÂ°´ÂÖ•„ÄëApps Script URLÔºàImageKit Á∞ΩÂêçÔºâ
            IMAGEKIT_AUTH_URL: 'https://script.google.com/macros/s/AKfycbyoVmFxHHtH8xnHlvUVrADYOepAywFyTLh9GSql8LMiahIdgxNMedrI0elfT1yDr2Fw/exec',
            
            // „ÄêË´ãÂ°´ÂÖ•„ÄëImageKit Public Key
            IMAGEKIT_PUBLIC_KEY: 'public_tS8YfdCMhUonkM8VMZ+cCg71SHw=',
            
            // „ÄêË´ãÂ°´ÂÖ•„ÄëImageKit URL Endpoint
            IMAGEKIT_URL_ENDPOINT: 'https://ik.imagekit.io/hanhealth/',
            
            // „ÄêË´ãÂ°´ÂÖ•„ÄëGitHub Pages Áõ∏Á∞øÁ∂≤ÂùÄÔºàÊ†ºÂºèÔºöhttps://‰Ω†ÁöÑÂ∏≥Ëôü.github.io/moti-album/Ôºâ
            ALBUM_BASE_URL: 'https://oxencust.github.io/moti-album/',
            
            // „ÄêË´ãÂ°´ÂÖ•„ÄëÈ™®È™ºËÇåËÇâÂúñ URLÔºà‰∏äÂÇ≥Âà∞ ImageKit ÂæåÂ°´ÂÖ•Ôºâ
            BODY_FRONT_URL: 'https://ik.imagekit.io/hanhealth/assets/body-front.png',
            BODY_BACK_URL: 'https://ik.imagekit.io/hanhealth/assets/body-back.png',
            BODY_SIDE_URL: 'https://ik.imagekit.io/hanhealth/assets/body-side.png',
            
            // ÂúñÁâáÂ£ìÁ∏ÆË®≠ÂÆöÔºà‰∏çÁî®ÊîπÔºâ
            MAX_IMAGE_WIDTH: 1200,
            IMAGE_QUALITY: 0.7,
            
            // ‰∏äÂÇ≥ÈôêÂà∂Ôºà‰∏çÁî®ÊîπÔºâ
            MAX_MOTI_IMAGES: 20,
            MAX_INBODY_IMAGES: 1
        };
        // ========================================================

        // ÂÖ®ÂüüËÆäÊï∏
        var motiFiles = [];
        var inbodyFiles = [];
        var memberData = null;
        var historyData = [];
        var currentPage = 1, currentSkeletonStep = 0, currentMuscleStepIndex = 0, muscleEntryCounter = 0;
        var lastMuscleInput = null; // ËøΩËπ§ÊúÄËøëÊñ∞Â¢ûÁöÑËÇåËÇâËº∏ÂÖ•Ê°Ü

        // ÁÜ±ÈªûÂ∫ßÊ®ô
        var hotspotsFS = [
            { id: 'f-skull', x: 28.3, y: 10.2, label: 'È†≠È°±', steps: [] },
            { id: 'f-cervical', x: 28.3, y: 21.8, label: 'È†∏Ê§é', steps: [1, 2] },
            { id: 'f-thoracic', x: 28.3, y: 29.8, label: 'ËÉ∏Ê§é', steps: [1, 3] },
            { id: 'f-ribs', x: 28.3, y: 25.7, label: 'ËÉ∏Âªì', steps: [10] },
            { id: 'f-lumbar', x: 28.3, y: 40.7, label: 'ËÖ∞Ê§é', steps: [1, 4] },
            { id: 'f-pelvis', x: 28.3, y: 46.8, label: 'È™®ÁõÜ', steps: [5] },
            { id: 'f-shoulder-l', x: 36.8, y: 24.3, label: 'Â∑¶ËÇ©ÈóúÁØÄ', steps: [8] },
            { id: 'f-shoulder-r', x: 19.4, y: 25.0, label: 'Âè≥ËÇ©ÈóúÁØÄ', steps: [8] },
            { id: 'f-hip-l', x: 34.9, y: 50.9, label: 'Â∑¶È´ñÈóúÁØÄ', steps: [9] },
            { id: 'f-hip-r', x: 22.0, y: 51.4, label: 'Âè≥È´ñÈóúÁØÄ', steps: [9] },
            { id: 'f-knee-l', x: 32.9, y: 69.6, label: 'Â∑¶ËÜùËìã', steps: [6, 9] },
            { id: 'f-knee-r', x: 24.5, y: 69.8, label: 'Âè≥ËÜùËìã', steps: [6, 9] },
            { id: 'f-ankle-l', x: 32.9, y: 89.7, label: 'Â∑¶ËÖ≥Ë∏ù', steps: [7, 9] },
            { id: 'f-ankle-r', x: 24.7, y: 89.9, label: 'Âè≥ËÖ≥Ë∏ù', steps: [7, 9] },
            { id: 's-skull', x: 73.6, y: 10.7, label: 'È†≠È°±(ÂÅ¥)', steps: [] },
            { id: 's-cervical', x: 72.7, y: 20.6, label: 'È†∏Ê§é(ÂÅ¥)', steps: [2] },
            { id: 's-thoracic', x: 69.3, y: 28.6, label: 'ËÉ∏Ê§é(ÂÅ¥)', steps: [3] },
            { id: 's-lumbar', x: 70.7, y: 41.2, label: 'ËÖ∞Ê§é(ÂÅ¥)', steps: [4] },
            { id: 's-pelvis', x: 71.0, y: 47.5, label: 'È™®ÁõÜ(ÂÅ¥)', steps: [5] },
            { id: 's-knee', x: 72.9, y: 70.0, label: 'ËÜùËìã(ÂÅ¥)', steps: [6] },
            { id: 's-ankle', x: 72.4, y: 90.6, label: 'ËÖ≥Ë∏ù(ÂÅ¥)', steps: [7] }
        ];

        var hotspotsFB = [
            { id: 'f-skull', x: 28.3, y: 10.4, label: 'È†≠È°±', steps: [] },
            { id: 'f-cervical', x: 28.3, y: 21.7, label: 'È†∏Ê§é', steps: [1, 2] },
            { id: 'f-thoracic', x: 28.3, y: 30.2, label: 'ËÉ∏Ê§é', steps: [1, 3] },
            { id: 'f-ribs', x: 28.3, y: 26.1, label: 'ËÉ∏Âªì', steps: [10] },
            { id: 'f-lumbar', x: 28.3, y: 40.6, label: 'ËÖ∞Ê§é', steps: [1, 4] },
            { id: 'f-pelvis', x: 28.3, y: 46.5, label: 'È™®ÁõÜ', steps: [5] },
            { id: 'f-shoulder-l', x: 37.3, y: 24.2, label: 'Â∑¶ËÇ©ÈóúÁØÄ', steps: [8] },
            { id: 'f-shoulder-r', x: 19.4, y: 24.7, label: 'Âè≥ËÇ©ÈóúÁØÄ', steps: [8] },
            { id: 'f-hip-l', x: 34.9, y: 51.3, label: 'Â∑¶È´ñÈóúÁØÄ', steps: [9] },
            { id: 'f-hip-r', x: 22.3, y: 51.5, label: 'Âè≥È´ñÈóúÁØÄ', steps: [9] },
            { id: 'f-knee-l', x: 32.9, y: 69.7, label: 'Â∑¶ËÜùËìã', steps: [6, 9] },
            { id: 'f-knee-r', x: 24.2, y: 70.0, label: 'Âè≥ËÜùËìã', steps: [6, 9] },
            { id: 'f-ankle-l', x: 33.2, y: 89.8, label: 'Â∑¶ËÖ≥Ë∏ù', steps: [7, 9] },
            { id: 'f-ankle-r', x: 25.0, y: 90.1, label: 'Âè≥ËÖ≥Ë∏ù', steps: [7, 9] },
            { id: 'b-skull', x: 69.3, y: 10.8, label: 'È†≠È°±(ËÉå)', steps: [] },
            { id: 'b-cervical', x: 69.0, y: 20.3, label: 'È†∏Ê§é(ËÉå)', steps: [2] },
            { id: 'b-thoracic', x: 68.8, y: 28.3, label: 'ËÉ∏Ê§é(ËÉå)', steps: [3] },
            { id: 'b-lumbar', x: 69.0, y: 39.7, label: 'ËÖ∞Ê§é(ËÉå)', steps: [4] },
            { id: 'b-pelvis-l', x: 64.9, y: 45.0, label: 'Â∑¶È™®ÁõÜ(ËÉå)', steps: [5] },
            { id: 'b-pelvis-r', x: 74.6, y: 44.8, label: 'Âè≥È™®ÁõÜ(ËÉå)', steps: [5] },
            { id: 'b-scapula-l', x: 63.2, y: 26.1, label: 'Â∑¶ËÇ©ËÉõÈ™®', steps: [8] },
            { id: 'b-scapula-r', x: 75.3, y: 26.3, label: 'Âè≥ËÇ©ËÉõÈ™®', steps: [8] },
            { id: 'b-hip-l', x: 63.0, y: 51.3, label: 'Â∑¶È´ñÈóúÁØÄ(ËÉå)', steps: [9] },
            { id: 'b-hip-r', x: 76.1, y: 51.5, label: 'Âè≥È´ñÈóúÁØÄ(ËÉå)', steps: [9] },
            { id: 'b-knee-l', x: 65.6, y: 69.7, label: 'Â∑¶ËÜùËìã(ËÉå)', steps: [6, 9] },
            { id: 'b-knee-r', x: 73.9, y: 70.0, label: 'Âè≥ËÜùËìã(ËÉå)', steps: [6, 9] },
            { id: 'b-ankle-l', x: 65.6, y: 89.8, label: 'Â∑¶ËÖ≥Ë∏ù(ËÉå)', steps: [7, 9] },
            { id: 'b-ankle-r', x: 73.4, y: 89.8, label: 'Âè≥ËÖ≥Ë∏ù(ËÉå)', steps: [7, 9] }
        ];

        var stepImageConfig = {
            0: 'fs', 1: 'fs', 2: 'fs', 3: 'fs', 4: 'fs', 5: 'fs', 7: 'fs', 10: 'fs',
            6: 'fb', 8: 'fb', 9: 'fb'
        };

        var muscleHotspots = [
            { id: 'front-neck', x: 27.2, y: 20.9, label: 'ËÉ∏Èéñ‰π≥Á™ÅËÇå', group: 'shoulder' },
            { id: 'front-deltoid-left', x: 39.2, y: 24.3, label: 'Â∑¶‰∏âËßíËÇå', group: 'shoulder' },
            { id: 'front-deltoid-right', x: 17.8, y: 24.3, label: 'Âè≥‰∏âËßíËÇå', group: 'shoulder' },
            { id: 'bicep-left', x: 40.2, y: 33.3, label: 'Â∑¶‰∫åÈ†≠ËÇå', group: 'shoulder' },
            { id: 'bicep-right', x: 18.4, y: 33.3, label: 'Âè≥‰∫åÈ†≠ËÇå', group: 'shoulder' },
            { id: 'pec-major-left', x: 23.4, y: 26.7, label: 'Â∑¶ËÉ∏Â§ßËÇå', group: 'chest' },
            { id: 'pec-major-right', x: 33.2, y: 26.7, label: 'Âè≥ËÉ∏Â§ßËÇå', group: 'chest' },
            { id: 'serratus-left', x: 35.2, y: 32.5, label: 'Â∑¶ÂâçÈã∏ËÇå', group: 'chest' },
            { id: 'serratus-right', x: 22.2, y: 32.5, label: 'Âè≥ÂâçÈã∏ËÇå', group: 'chest' },
            { id: 'rectus-upper', x: 28.6, y: 34.9, label: '‰∏äËÖπÁõ¥ËÇå', group: 'core' },
            { id: 'rectus-lower', x: 28.6, y: 43.3, label: '‰∏ãËÖπÁõ¥ËÇå', group: 'core' },
            { id: 'oblique-left', x: 34.2, y: 40.3, label: 'Â∑¶ËÖπÂ§ñÊñúËÇå', group: 'core' },
            { id: 'oblique-right', x: 23.2, y: 40.3, label: 'Âè≥ËÖπÂ§ñÊñúËÇå', group: 'core' },
            { id: 'iliopsoas-left', x: 32.8, y: 46.5, label: 'Â∑¶È´ÇËÖ∞ËÇå', group: 'core' },
            { id: 'iliopsoas-right', x: 24.2, y: 46.5, label: 'Âè≥È´ÇËÖ∞ËÇå', group: 'core' },
            { id: 'tfl-left', x: 36.8, y: 50.5, label: 'Â∑¶ÈóäÁ≠ãËÜúÂºµËÇå', group: 'glute' },
            { id: 'tfl-right', x: 20.6, y: 50.5, label: 'Âè≥ÈóòÁ≠ãËÜúÂºµËÇå', group: 'glute' },
            { id: 'quad-left', x: 34.0, y: 60.7, label: 'Â∑¶ËÇ°ÂõõÈ†≠ËÇå', group: 'leg' },
            { id: 'quad-right', x: 23.2, y: 60.7, label: 'Âè≥ËÇ°ÂõõÈ†≠ËÇå', group: 'leg' },
            { id: 'adductor-left', x: 30.8, y: 56.1, label: 'Â∑¶ÂÖßÊî∂ËÇåÁæ§', group: 'leg' },
            { id: 'adductor-right', x: 26.2, y: 56.1, label: 'Âè≥ÂÖßÊî∂ËÇåÁæ§', group: 'leg' },
            { id: 'tibialis-left', x: 33.0, y: 77.1, label: 'Â∑¶ËÑõÂâçËÇå', group: 'leg' },
            { id: 'tibialis-right', x: 23.6, y: 77.1, label: 'Âè≥ËÑõÂâçËÇå', group: 'leg' },
            { id: 'tricep-left', x: 61.6, y: 31.5, label: 'Â∑¶‰∏âÈ†≠ËÇå', group: 'shoulder' },
            { id: 'tricep-right', x: 84.0, y: 31.5, label: 'Âè≥‰∏âÈ†≠ËÇå', group: 'shoulder' },
            { id: 'upper-trap', x: 76.0, y: 21.1, label: '‰∏äÊñúÊñπËÇå', group: 'back' },
            { id: 'mid-trap', x: 71.0, y: 25.1, label: '‰∏≠ÊñúÊñπËÇå', group: 'back' },
            { id: 'lower-trap', x: 70.4, y: 29.1, label: '‰∏ãÊñúÊñπËÇå', group: 'back' },
            { id: 'rhomboid-left', x: 68.0, y: 27.5, label: 'Â∑¶Ëè±ÂΩ¢ËÇå', group: 'back' },
            { id: 'rhomboid-right', x: 77.6, y: 27.5, label: 'Âè≥Ëè±ÂΩ¢ËÇå', group: 'back' },
            { id: 'lat-left', x: 67.4, y: 33.3, label: 'Â∑¶ÈóòËÉåËÇå', group: 'back' },
            { id: 'lat-right', x: 77.8, y: 33.3, label: 'Âè≥ÈóòËÉåËÇå', group: 'back' },
            { id: 'erector-spinae', x: 72.6, y: 35.9, label: 'Ë±éËÑäËÇå', group: 'back' },
            { id: 'glute-med-left', x: 67.2, y: 45.1, label: 'Â∑¶ËáÄ‰∏≠ËÇå', group: 'glute' },
            { id: 'glute-med-right', x: 77.4, y: 45.1, label: 'Âè≥ËáÄ‰∏≠ËÇå', group: 'glute' },
            { id: 'glute-max-left', x: 68.8, y: 50.5, label: 'Â∑¶ËáÄÂ§ßËÇå', group: 'glute' },
            { id: 'glute-max-right', x: 75.8, y: 50.5, label: 'Âè≥ËáÄÂ§ßËÇå', group: 'glute' },
            { id: 'hamstring-left', x: 67.8, y: 60.3, label: 'Â∑¶ËÖøÂæåËÇåÁæ§', group: 'leg' },
            { id: 'hamstring-right', x: 77.4, y: 60.3, label: 'Âè≥ËÖøÂæåËÇåÁæ§', group: 'leg' },
            { id: 'gastrocnemius-left', x: 68.6, y: 76.5, label: 'Â∑¶ËÖìËÖ∏ËÇå', group: 'leg' },
            { id: 'gastrocnemius-right', x: 76.8, y: 76.5, label: 'Âè≥ËÖìËÖ∏ËÇå', group: 'leg' },
            { id: 'soleus-left', x: 68.6, y: 84.5, label: 'Â∑¶ÊØîÁõÆÈ≠öËÇå', group: 'leg' },
            { id: 'soleus-right', x: 76.6, y: 84.5, label: 'Âè≥ÊØîÁõÆÈ≠öËÇå', group: 'leg' }
        ];

        var muscleGroups = ['shoulder', 'chest', 'back', 'core', 'glute', 'leg'];
        
        // ÂàÜÊûêÂ∏´Ë≥áÊñô
        var analystData = null;

        // ==================== ÂàùÂßãÂåñ ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Ë®≠ÂÆöÈ™®È™ºËÇåËÇâÂúñÁâá URL
            document.getElementById('skeletonFS').src = CONFIG.BODY_FRONT_URL;
            document.getElementById('skeletonFB').src = CONFIG.BODY_BACK_URL;
            document.getElementById('muscleImage').src = CONFIG.BODY_SIDE_URL;
            
            // Ë®≠ÂÆöÈ†êË®≠Êó•ÊúüÂíåÊôÇÈñì
            var now = new Date();
            document.getElementById('assessmentDate').valueAsDate = now;
            var hours = String(now.getHours()).padStart(2, '0');
            var minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('assessmentTime').value = hours + ':' + minutes;
            
            initMuscleHotspots();
            initDragDrop();
            updateSkeletonStep();
            updateMuscleStep();
            
            // ÂÖàÂàùÂßãÂåñ LIFF ÁôªÂÖ•ÔºåÁôªÂÖ•ÊàêÂäüÂæåÊâçËºâÂÖ•ÊïôÁ∑¥ÂêçÂñÆ
            initLiff();
        });
        
        // ==================== LIFF ÂàùÂßãÂåñ ====================
        async function initLiff() {
            console.log('initLiff ÈñãÂßãÂü∑Ë°å');
            try {
                console.log('LIFF ID:', CONFIG.LIFF_ID);
                await liff.init({ liffId: CONFIG.LIFF_ID });
                console.log('LIFF ÂàùÂßãÂåñÊàêÂäü');
                
                if (!liff.isLoggedIn()) {
                    console.log('Áî®Êà∂Êú™ÁôªÂÖ•ÔºåÂ∞éÂêë LINE ÁôªÂÖ•');
                    // Êú™ÁôªÂÖ•ÔºåÂ∞éÂêë LINE ÁôªÂÖ•
                    liff.login({ redirectUri: window.location.href });
                    return;
                }
                
                console.log('Áî®Êà∂Â∑≤ÁôªÂÖ•ÔºåÂèñÂæóË≥áÊñô‰∏≠...');
                // Â∑≤ÁôªÂÖ•ÔºåÂèñÂæóÁî®Êà∂Ë≥áÊñô
                var profile = await liff.getProfile();
                var lineUserId = profile.userId;
                
                console.log('LINE User ID:', lineUserId);
                
                // ÂÑ≤Â≠òÂà∞Èö±ËóèÊ¨Ñ‰Ωç
                document.getElementById('analystLineId').value = lineUserId;
                
                // Êü•Ë©¢ÂàÜÊûêÂ∏´Ë≥áÊñô
                console.log('ÈñãÂßãÊü•Ë©¢ÂàÜÊûêÂ∏´...');
                await loadAnalyst(lineUserId);
                
                // ÁôªÂÖ•ÊàêÂäüÂæåËºâÂÖ•ÊïôÁ∑¥ÂêçÂñÆ
                console.log('ÈñãÂßãËºâÂÖ•ÊïôÁ∑¥ÂêçÂñÆ...');
                await loadCoaches();
                
            } catch (error) {
                console.error('LIFF init error:', error);
                // LIFF ÂàùÂßãÂåñÂ§±ÊïóÔºåÈö±ËóèÂàÜÊûêÂ∏´Ê¨Ñ‰Ωç
                document.getElementById('analystGroup').style.display = 'none';
            }
        }
        
        // Êü•Ë©¢ÂàÜÊûêÂ∏´ÔºàÂæûÊïôÁ∑¥Ë°®Ôºâ
        async function loadAnalyst(lineUserId) {
            console.log('loadAnalyst ÈñãÂßãÂü∑Ë°åÔºålineUserId:', lineUserId);
            try {
                var response = await fetch(CONFIG.MAKE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'get_analyst',
                        lineId: lineUserId
                    })
                });
                
                var result = await response.json();
                console.log('get_analyst ÁµêÊûú:', result);
                
                if (result.success && result.analyst) {
                    analystData = result.analyst;
                    document.getElementById('analystName').textContent = result.analyst.name;
                    document.getElementById('analystGroup').style.display = 'block';
                    console.log('ÂàÜÊûêÂ∏´ËºâÂÖ•ÊàêÂäü:', result.analyst.name);
                } else {
                    // Êâæ‰∏çÂà∞ÂàÜÊûêÂ∏´ÔºåÈö±ËóèÊ¨Ñ‰Ωç
                    document.getElementById('analystGroup').style.display = 'none';
                    console.log('Êâæ‰∏çÂà∞Â∞çÊáâÁöÑÂàÜÊûêÂ∏´');
                }
            } catch (error) {
                console.error('Load analyst error:', error);
                document.getElementById('analystGroup').style.display = 'none';
            }
        }

        // ==================== ÊïôÁ∑¥ÂêçÂñÆËºâÂÖ• ====================
        async function loadCoaches() {
            try {
                var response = await fetch(CONFIG.MAKE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'get_coaches' })
                });
                
                var result = await response.json();
                
                if (result.success && result.coaches) {
                    renderCoaches(result.coaches);
                } else {
                    showCoachError();
                }
            } catch (error) {
                console.error('Load coaches error:', error);
                showCoachError();
            }
        }
        
        function renderCoaches(coaches) {
            var weightCoaches = coaches.filter(function(c) { return c.coach_type === 'weight'; });
            var pilatesCoaches = coaches.filter(function(c) { return c.coach_type === 'pilates'; });
            var stretchCoaches = coaches.filter(function(c) { return c.coach_type === 'stretch'; });
            
            renderCoachGrid('weightCoaches', weightCoaches, 'weight');
            renderCoachGrid('pilatesCoaches', pilatesCoaches, 'pilates');
            renderCoachGrid('stretchCoaches', stretchCoaches, 'stretch');
            
            // ÂàùÂßãÂåñË©ïÂàÜÂäüËÉΩ
            initHalfStarRatings();
        }
        
        function renderCoachGrid(containerId, coaches, coachType) {
            var container = document.getElementById(containerId);
            
            if (coaches.length === 0) {
                container.innerHTML = '<div class="coach-empty">ÁõÆÂâçÊ≤íÊúâÊïôÁ∑¥</div>';
                return;
            }
            
            var html = coaches.map(function(coach) {
                var coachId = coach.coach_name.replace(/\s/g, '_');
                return '<div class="coach-card">' +
                    '<div class="coach-name">' + coach.coach_name + '</div>' +
                    '<div class="half-star-rating" data-coach="' + coachId + '" data-type="' + coachType + '" data-name="' + coach.coach_name + '">' +
                    '<div class="star-container" data-star="1"><span class="star-bg">‚òÖ</span><span class="star-fill">‚òÖ</span></div>' +
                    '<div class="star-container" data-star="2"><span class="star-bg">‚òÖ</span><span class="star-fill">‚òÖ</span></div>' +
                    '<div class="star-container" data-star="3"><span class="star-bg">‚òÖ</span><span class="star-fill">‚òÖ</span></div>' +
                    '<span class="rating-value">0</span>' +
                    '</div></div>';
            }).join('');
            
            container.innerHTML = html;
        }
        
        function showCoachError() {
            ['weightCoaches', 'pilatesCoaches', 'stretchCoaches'].forEach(function(id) {
                document.getElementById(id).innerHTML = '<div class="coach-empty">ÁÑ°Ê≥ïËºâÂÖ•ÊïôÁ∑¥ÂêçÂñÆ</div>';
            });
        }

        // ==================== ÊúÉÂì°Êü•Ë©¢ ====================
        async function searchMember() {
            var name = document.getElementById('memberName').value.trim();
            var phone = document.getElementById('memberPhone').value.trim();
            
            if (!name || !phone) {
                showToast('Ë´ãËº∏ÂÖ•ÂßìÂêçÂíåÈõªË©±');
                return;
            }
            
            showLoading('Êü•Ë©¢ÊúÉÂì°‰∏≠...');
            
            try {
                var response = await fetch(CONFIG.MAKE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'query_member',
                        name: name,
                        phone: phone
                    })
                });
                
                var result = await response.json();
                hideLoading();
                
                if (result.success && result.member) {
                    memberData = result.member;
                    var history = result.history || [];
                    showMemberResult(result.member, history);
                    
                    // Ëá™ÂãïÂ°´ÂÖ•ÂÄã‰∫∫Ë≥áÊñôÔºöÂÑ™ÂÖàÁî®ÊúÄÊñ∞Ê≠∑Âè≤Á¥ÄÈåÑÔºåÊ≤íÊúâÂâáÁî®Ë´ÆË©¢ÂñÆË≥áÊñô
                    var latestHistory = history.length > 0 ? history[0] : null;
                    fillPersonalData(result.member, latestHistory);
                } else {
                    showMemberError('Êü•ÁÑ°Ê≠§ÊúÉÂì°ÔºåË´ãÁ¢∫Ë™çÂßìÂêçÂíåÈõªË©±ÊòØÂê¶Ê≠£Á¢∫ÔºåÊàñÂÖàËá≥Á≥ªÁµ±Âª∫Ê™î');
                }
            } catch (error) {
                hideLoading();
                showMemberError('Êü•Ë©¢Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                console.error('Search error:', error);
            }
        }

        function showMemberResult(member, history) {
            var html = '<div class="member-result">' +
                '<div class="member-result-title">‚úÖ Êü•Ë©¢ÊàêÂäü</div>' +
                '<div class="member-info-grid">' +
                '<div class="member-info-item"><span class="member-info-label">Â≠∏ÁîüÁ∑®Ëôü</span><span class="member-info-value">' + member.id + '</span></div>' +
                '<div class="member-info-item"><span class="member-info-label">ÂßìÂêç</span><span class="member-info-value">' + member.name + '</span></div>' +
                '<div class="member-info-item"><span class="member-info-label">ÈõªË©±</span><span class="member-info-value">' + member.phone + '</span></div>' +
                '</div>';
            
            // ÂÑ≤Â≠òÊ≠∑Âè≤Ë≥áÊñôÂà∞ÂÖ®ÂüüËÆäÊï∏ÔºàÂæûËàäÂà∞Êñ∞ÊéíÂ∫èÔºâ
            historyData = history.slice().reverse();
            
            // ÊôÇÈñìËª∏ÂçÄÂ°ä
            html += '<div class="timeline-section">' +
                '<div class="timeline-title">üìã Ê™¢Ê∏¨Ê≠∑Á®ã</div>' +
                '<div class="timeline-container">' +
                '<div class="timeline-track">';
            
            // Ê≠∑Âè≤Á¥ÄÈåÑÁØÄÈªû
            historyData.forEach(function(h, index) {
                var dateStr = h.date || '';
                var dateObj = new Date(dateStr.replace(/\//g, '-'));
                var month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
                var day = dateObj.getDate().toString().padStart(2, '0');
                var year = dateObj.getFullYear();
                var hours = dateObj.getHours().toString().padStart(2, '0');
                var minutes = dateObj.getMinutes().toString().padStart(2, '0');
                var timeStr = hours + ':' + minutes;
                
                html += '<div class="timeline-node" data-index="' + index + '" onclick="showHistoryDetail(' + index + ')">' +
                    '<div class="timeline-dot"></div>' +
                    '<div class="timeline-date">' + month + '/' + day + '</div>' +
                    '<div class="timeline-year">' + year + '</div>' +
                    '<div class="timeline-time">' + timeStr + '</div>' +
                    '</div>';
            });
            
            // ‰ªäÂ§©ÁöÑÁØÄÈªûÔºàÊñ∞Â¢ûÊ™¢Ê∏¨Ôºâ
            html += '<div class="timeline-node timeline-node-new">' +
                '<div class="timeline-dot new"></div>' +
                '<div class="timeline-date">‰ªäÂ§©</div>' +
                '<div class="timeline-year">Êñ∞Â¢û</div>' +
                '</div>';
            
            html += '</div></div>'; // ÈóúÈñâ timeline-track Âíå timeline-container
            
            // Ê≠∑Âè≤Ë©≥ÊÉÖÈ°ØÁ§∫ÂçÄ
            if (historyData.length > 0) {
                html += '<div class="timeline-detail" id="timelineDetail">' +
                    '<div class="timeline-detail-hint">üëÜ ÈªûÊìä‰∏äÊñπÊôÇÈñìÈªûÊü•ÁúãË©≥Á¥∞Á¥ÄÈåÑ</div>' +
                    '</div>';
            } else {
                html += '<div class="first-time-badge">üéâ È¶ñÊ¨°Ê™¢Ê∏¨ÔºåÈñãÂßãÂª∫Á´ãÈ´îÊÖãÁ¥ÄÈåÑÂêßÔºÅ</div>';
            }
            
            html += '</div>'; // ÈóúÈñâ timeline-section
            html += '</div>'; // ÈóúÈñâ member-result
            
            document.getElementById('memberSearchResult').innerHTML = html;
        }
        
        // Â°´ÂÖ•ÂÄã‰∫∫Ë≥áÊñôÔºàÂæûË´ÆË©¢ÂñÆ/MySQLÔºâ
        // Â°´ÂÖ•ÂÄã‰∫∫Ë≥áÊñôÔºàÂÑ™ÂÖàÁî®Ê≠∑Âè≤Á¥ÄÈåÑÔºåÊ≤íÊúâÊâçÁî®Ë´ÆË©¢ÂñÆË≥áÊñôÔºâ
        function fillPersonalData(member, history) {
            var hasHistory = history && (history.goals || history.diseases || history.notes);
            console.log('fillPersonalData Ë¢´ÂëºÂè´ÔºåÊúâÊ≠∑Âè≤Ôºö', hasHistory);
            
            // Ê±∫ÂÆöË≥áÊñô‰æÜÊ∫ê
            var goalsData = (history && history.goals) ? history.goals : member.goals;
            var diseasesData = (history && history.diseases) ? history.diseases : member.medical_history;
            var notesData = (history && history.notes) ? history.notes : member.consultation_notes;
            var exerciseData = member.exercise_exp; // ÈÅãÂãïÁ∂ìÈ©óÂè™ÂæûË´ÆË©¢ÂñÆ‰æÜ
            
            var hasData = false;
            
            // 1. Â°´ÂÖ•ÂÅ•Ë∫´ÁõÆÊ®ô
            if (goalsData) {
                hasData = true;
                var goals = goalsData;
                // Â¶ÇÊûúÊòØ JSON Â≠ó‰∏≤ÔºåËß£ÊûêÂÆÉ
                if (typeof goals === 'string') {
                    try {
                        goals = JSON.parse(goals);
                    } catch (e) {
                        goals = goals.split(/[,„ÄÅÔºå\/]/);
                    }
                }
                if (Array.isArray(goals)) {
                    goals.forEach(function(goal) {
                        goal = String(goal).trim();
                        if (!goal) return;
                        document.querySelectorAll('input[name="goals"]').forEach(function(cb) {
                            if (cb.value === goal || goal.includes(cb.value) || cb.value.includes(goal)) {
                                cb.checked = true;
                                cb.closest('.checkbox-label').classList.add('selected');
                            }
                        });
                    });
                }
            }
            
            // 2. Â°´ÂÖ•ÁñæÁóÖÂè≤
            if (diseasesData) {
                hasData = true;
                var diseases = diseasesData;
                if (typeof diseases === 'string') {
                    try {
                        diseases = JSON.parse(diseases);
                    } catch (e) {
                        diseases = diseases.split(/[,„ÄÅÔºå]/);
                    }
                }
                if (Array.isArray(diseases)) {
                    diseases.forEach(function(disease) {
                        disease = String(disease).trim();
                        if (!disease) return;
                        var baseName = disease.split(/[:Ôºö]/)[0].trim();
                        var detail = disease.split(/[:Ôºö]/)[1] ? disease.split(/[:Ôºö]/)[1].trim() : '';
                        
                        document.querySelectorAll('input[name="disease"]').forEach(function(cb) {
                            if (cb.value === baseName || baseName.includes(cb.value) || cb.value.includes(baseName)) {
                                cb.checked = true;
                                cb.closest('.checkbox-label').classList.add('selected');
                                
                                if (detail) {
                                    if (baseName === 'ÈóúÁØÄÂïèÈ°å' || baseName.includes('ÈóúÁØÄ')) {
                                        var input = document.getElementById('jointInput');
                                        if (input) { input.value = detail; input.disabled = false; }
                                    } else if (baseName === 'ËÑäÊ§éÂïèÈ°å' || baseName.includes('ËÑäÊ§é')) {
                                        var input = document.getElementById('spineInput');
                                        if (input) { input.value = detail; input.disabled = false; }
                                    } else if (baseName === 'ÂÖ∂‰ªñ') {
                                        var input = document.getElementById('otherDiseaseInput');
                                        if (input) { input.value = detail; input.disabled = false; }
                                    }
                                }
                            }
                        });
                    });
                }
            }
            
            // 3. Â°´ÂÖ•ÈÅãÂãïÁ∂ìÈ©óÔºàÂè™ÂæûË´ÆË©¢ÂñÆ‰æÜÔºåÊ≠∑Âè≤Á¥ÄÈåÑ‰∏çÂ≠òÈÄôÂÄãÔºâ
            if (exerciseData && !hasHistory) {
                hasData = true;
                var expValue = exerciseData.trim();
                if (expValue === 'ÁÑ°') {
                    var noExpCb = document.querySelector('input[name="exercise"][value="ÁÑ°"]');
                    if (noExpCb) {
                        noExpCb.checked = true;
                        noExpCb.closest('.checkbox-label').classList.add('selected');
                    }
                } else if (expValue) {
                    var hasExpCb = document.querySelector('input[name="exercise"][value="Êúâ"]');
                    if (hasExpCb) {
                        hasExpCb.checked = true;
                        hasExpCb.closest('.checkbox-label').classList.add('selected');
                        toggleExerciseDetails();
                        
                        var expDetail = expValue.replace(/^Êúâ[:Ôºö]?\s*/, '');
                        if (expDetail) {
                            document.getElementById('exerciseType').value = expDetail;
                        }
                    }
                }
            }
            
            // 4. Â°´ÂÖ•ÂÇôË®ª
            if (notesData) {
                hasData = true;
                document.getElementById('notes').value = notesData;
            }
            
            // È°ØÁ§∫ÊèêÁ§∫
            if (hasData) {
                if (hasHistory) {
                    showToast('Â∑≤ËºâÂÖ•‰∏äÊ¨°Ê™¢Ê∏¨Ë≥áÊñôÔºåÂèØÁ∑®ËºØË™øÊï¥');
                } else {
                    showToast('Â∑≤ËºâÂÖ•Ë´ÆË©¢ÂñÆË≥áÊñôÔºåÂèØÁ∑®ËºØË™øÊï¥');
                }
            }
        }
        
        function showHistoryDetail(index) {
            var h = historyData[index];
            if (!h) return;
            
            // È´ò‰∫ÆÈÅ∏‰∏≠ÁöÑÁØÄÈªû
            document.querySelectorAll('.timeline-node').forEach(function(node, i) {
                node.classList.toggle('active', i === index);
            });
            
            var risks = [h.risk_1, h.risk_2, h.risk_3].filter(function(r) { return r; });
            var risksHtml = risks.length > 0 
                ? risks.map(function(r, i) { return '<span class="risk-tag">' + (i + 1) + '. ' + r + '</span>'; }).join('')
                : '<span class="no-data">ÁÑ°Á¥ÄÈåÑ</span>';
            
            var html = '<div class="detail-card animate-in">' +
                '<div class="detail-header">' +
                '<span class="detail-date">üìÖ ' + h.date + '</span>' +
                '<span class="detail-badge">Á¨¨ ' + (index + 1) + ' Ê¨°Ê™¢Ê∏¨</span>' +
                '</div>' +
                '<div class="detail-body">' +
                '<div class="detail-row">' +
                '<span class="detail-label">‚ö†Ô∏è È¢®Èö™ÊéíÂêç</span>' +
                '<div class="risk-tags">' + risksHtml + '</div>' +
                '</div>' +
                '<div class="detail-row">' +
                '<span class="detail-label">üìù Âª∫Ë≠∞Â†ÇÊï∏</span>' +
                '<span class="detail-value">' + (h.total_courses || 0) + ' Â†Ç</span>' +
                '</div>';
            
            // Áü≠ÊúüÁõÆÊ®ô
            if (h.short_term_goal) {
                html += '<div class="detail-row">' +
                    '<span class="detail-label">üéØ Áü≠ÊúüÁõÆÊ®ô</span>' +
                    '<span class="detail-value">' + h.short_term_goal + '</span>' +
                    '</div>';
            }
            
            // È™®È™ºË©ï‰º∞ÂÇôË®ª
            var skeletonNotes = collectHistorySkeletonNotes(h);
            if (skeletonNotes.length > 0) {
                html += '<div class="detail-row">' +
                    '<span class="detail-label">ü¶¥ È™®È™ºË©ï‰º∞ÂÇôË®ª</span>' +
                    '<div class="note-list">' + skeletonNotes.map(function(n) {
                        return '<div class="note-item"><span class="note-title">' + n.title + 'Ôºö</span>' + n.content + '</div>';
                    }).join('') + '</div>' +
                    '</div>';
            }
            
            // ËÇåËÇâË©ï‰º∞ÂÇôË®ª
            var muscleNotes = collectHistoryMuscleNotes(h);
            if (muscleNotes.length > 0) {
                html += '<div class="detail-row">' +
                    '<span class="detail-label">üí™ ËÇåËÇâË©ï‰º∞ÂÇôË®ª</span>' +
                    '<div class="note-list">' + muscleNotes.map(function(n) {
                        return '<div class="note-item"><span class="note-title">' + n.title + 'Ôºö</span>' + n.content + '</div>';
                    }).join('') + '</div>' +
                    '</div>';
            }
            
            html += '</div></div>';
            
            document.getElementById('timelineDetail').innerHTML = html;
        }
        
        function collectHistorySkeletonNotes(h) {
            var notes = [];
            var noteMapping = [
                { key: 'note_scoliosis', title: 'ËÑäÊ§éÂÅ¥ÂΩé' },
                { key: 'note_thoracic_curve', title: 'ËÉ∏Ê§éÂÅ¥ÂΩé' },
                { key: 'note_lumbar_curve', title: 'ËÖ∞Ê§éÂÅ¥ÂΩé' },
                { key: 'note_cervical', title: 'È†∏Ê§é' },
                { key: 'note_thoracic', title: 'ËÉ∏Ê§é' },
                { key: 'note_lumbar', title: 'ËÖ∞Ê§é' },
                { key: 'note_pelvis_tilt', title: 'È™®ÁõÜÂâçÂæåÂÇæ' },
                { key: 'note_pelvis_side', title: 'È™®ÁõÜÂ∑¶Âè≥È´ò‰Ωé' },
                { key: 'note_pelvis_rotation', title: 'È™®ÁõÜÊóãËΩâ' },
                { key: 'note_functional_tilt', title: 'ÂäüËÉΩÊÄßÂæåÂÇæ' },
                { key: 'note_left_knee', title: 'Â∑¶ËÜù' },
                { key: 'note_right_knee', title: 'Âè≥ËÜù' },
                { key: 'note_arch', title: 'Ë∂≥Âºì' },
                { key: 'note_foot_rotation', title: 'Ë∂≥ÈÉ®ÊóãËΩâ' },
                { key: 'note_shrug', title: 'ËÅ≥ËÇ©' },
                { key: 'note_round_shoulder', title: 'ÂúìËÇ©' },
                { key: 'note_scapula', title: 'ËÇ©ËÉõÈ™®' },
                { key: 'note_humerus', title: 'ËÇ±È™®' },
                { key: 'note_hip', title: 'È´ñÈóúÁØÄ' },
                { key: 'note_knee_stability', title: 'ËÜùÈóúÁØÄÁ©©ÂÆö' },
                { key: 'note_ankle_stability', title: 'Ë∏ùÈóúÁØÄÁ©©ÂÆö' },
                { key: 'note_breathing_shallow', title: 'ÂëºÂê∏Áü≠Ê∑∫' },
                { key: 'note_breathing_pattern', title: 'ÂëºÂê∏Ê®°Âºè' }
            ];
            
            noteMapping.forEach(function(item) {
                if (h[item.key] && h[item.key].trim()) {
                    notes.push({ title: item.title, content: h[item.key] });
                }
            });
            
            return notes;
        }
        
        function collectHistoryMuscleNotes(h) {
            var notes = [];
            if (!h.muscle_data) return notes;
            
            try {
                var muscleData = typeof h.muscle_data === 'string' ? JSON.parse(h.muscle_data) : h.muscle_data;
                var groupNames = {
                    shoulder: 'ËÇ©ËÜÄ',
                    chest: 'ËÉ∏ÈÉ®',
                    back: 'ËÉåÈÉ®',
                    core: 'Ê†∏ÂøÉ',
                    glute: 'ËáÄÈÉ®',
                    leg: 'ËÖøÈÉ®'
                };
                
                Object.keys(muscleData).forEach(function(group) {
                    var muscles = muscleData[group];
                    if (Array.isArray(muscles)) {
                        muscles.forEach(function(m) {
                            if (m.note && m.note.trim()) {
                                var title = (groupNames[group] || group) + ' - ' + (m.name || 'Êú™ÂëΩÂêç');
                                notes.push({ title: title, content: m.note });
                            }
                        });
                    }
                });
            } catch (e) {
                console.error('Parse muscle_data error:', e);
            }
            
            return notes;
        }

        function showMemberError(msg) {
            document.getElementById('memberSearchResult').innerHTML = '<div class="search-error">' + msg + '</div>';
            memberData = null;
        }

        // ==================== ÂúñÁâá‰∏äÂÇ≥ ====================
        function initDragDrop() {
            ['motiUploadZone', 'inbodyUploadZone'].forEach(function(id) {
                var zone = document.getElementById(id);
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                zone.addEventListener('dragleave', function() {
                    this.classList.remove('dragover');
                });
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    var type = id === 'motiUploadZone' ? 'moti' : 'inbody';
                    handleFiles(e.dataTransfer.files, type);
                });
            });
        }

        function handleFileSelect(event, type) {
            handleFiles(event.target.files, type);
        }

        async function handleFiles(files, type) {
            var maxFiles = type === 'moti' ? CONFIG.MAX_MOTI_IMAGES : CONFIG.MAX_INBODY_IMAGES;
            var currentFiles = type === 'moti' ? motiFiles : inbodyFiles;
            
            for (var i = 0; i < files.length; i++) {
                if (currentFiles.length >= maxFiles) {
                    showToast('Â∑≤ÈÅîÂà∞ÊúÄÂ§ßÊï∏ÈáèÈôêÂà∂');
                    break;
                }
                
                var file = files[i];
                if (!file.type.startsWith('image/')) continue;
                
                // Â£ìÁ∏ÆÂúñÁâá
                var compressed = await compressImage(file);
                currentFiles.push(compressed);
            }
            
            if (type === 'moti') {
                motiFiles = currentFiles;
            } else {
                inbodyFiles = currentFiles;
            }
            
            updatePreview(type);
        }

        function compressImage(file) {
            return new Promise(function(resolve) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img = new Image();
                    img.onload = function() {
                        var canvas = document.createElement('canvas');
                        var ctx = canvas.getContext('2d');
                        
                        var width = img.width;
                        var height = img.height;
                        
                        if (width > CONFIG.MAX_IMAGE_WIDTH) {
                            height = (height * CONFIG.MAX_IMAGE_WIDTH) / width;
                            width = CONFIG.MAX_IMAGE_WIDTH;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob(function(blob) {
                            resolve(new File([blob], file.name, { type: 'image/jpeg' }));
                        }, 'image/jpeg', CONFIG.IMAGE_QUALITY);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function updatePreview(type) {
            var files = type === 'moti' ? motiFiles : inbodyFiles;
            var maxFiles = type === 'moti' ? CONFIG.MAX_MOTI_IMAGES : CONFIG.MAX_INBODY_IMAGES;
            var container = document.getElementById(type + 'Preview');
            var countEl = document.getElementById(type + 'Count');
            
            container.innerHTML = '';
            files.forEach(function(file, index) {
                var div = document.createElement('div');
                div.className = 'preview-item';
                
                var img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                
                var btn = document.createElement('button');
                btn.className = 'preview-remove';
                btn.innerHTML = '√ó';
                btn.onclick = function() { removeFile(type, index); };
                
                div.appendChild(img);
                div.appendChild(btn);
                container.appendChild(div);
            });
            
            countEl.textContent = 'Â∑≤ÈÅ∏Êìá ' + files.length + ' / ' + maxFiles + ' Âºµ';
        }

        function removeFile(type, index) {
            if (type === 'moti') {
                motiFiles.splice(index, 1);
            } else {
                inbodyFiles.splice(index, 1);
            }
            updatePreview(type);
        }

        // ==================== ÂúñÁâá‰∏äÂÇ≥Âà∞ ImageKit ====================
        async function uploadToImageKit(file, folder) {
            // Âæû Apps Script ÂèñÂæóÁ∞ΩÂêç
            var authResponse = await fetch(CONFIG.IMAGEKIT_AUTH_URL, {
                method: 'GET'
            });
            var auth = await authResponse.json();
            
            // ‰∏äÂÇ≥ÂúñÁâáÂà∞ ImageKit
            var formData = new FormData();
            formData.append('file', file);
            formData.append('publicKey', CONFIG.IMAGEKIT_PUBLIC_KEY);
            formData.append('signature', auth.signature);
            formData.append('expire', auth.expire);
            formData.append('token', auth.token);
            formData.append('folder', folder);
            formData.append('fileName', Date.now() + '_' + file.name.replace(/[^a-zA-Z0-9.]/g, '_'));
            
            var uploadResponse = await fetch('https://upload.imagekit.io/api/v1/files/upload', {
                method: 'POST',
                body: formData
            });
            
            var result = await uploadResponse.json();
            
            if (result.error) {
                throw new Error(result.error.message || '‰∏äÂÇ≥Â§±Êïó');
            }
            
            return result.url;
        }

        async function uploadAllImages(memberId, memberName, assessmentDate) {
            var motiUrls = [];
            var inbodyUrl = '';
            var totalFiles = motiFiles.length + inbodyFiles.length;
            var uploadedCount = 0;
            
            if (totalFiles === 0) return { motiUrls: [], inbodyUrl: '', motiFolder: '' };
            
            var folderName = memberId + '_' + memberName;
            var motiFolder = 'moti/' + folderName + '/' + assessmentDate;
            var inbodyFolder = 'inbody/' + folderName + '/' + assessmentDate;
            
            document.getElementById('uploadProgress').classList.add('active');
            
            // ‰∏¶Ë°å‰∏äÂÇ≥ Moti ÁÖßÁâáÔºàÂêåÊôÇ 5 ÂºµÔºâ
            var CONCURRENT_LIMIT = 5;
            for (var i = 0; i < motiFiles.length; i += CONCURRENT_LIMIT) {
                var batch = motiFiles.slice(i, i + CONCURRENT_LIMIT);
                var promises = batch.map(function(file) {
                    return uploadToImageKit(file, motiFolder)
                        .then(function(url) {
                            uploadedCount++;
                            updateProgress(uploadedCount, totalFiles);
                            return url;
                        })
                        .catch(function(error) {
                            console.error('Moti upload error:', error);
                            uploadedCount++;
                            updateProgress(uploadedCount, totalFiles);
                            return null;
                        });
                });
                
                var results = await Promise.all(promises);
                results.forEach(function(url) {
                    if (url) motiUrls.push(url);
                });
            }
            
            // ‰∏äÂÇ≥ InBody ÁÖßÁâá
            if (inbodyFiles.length > 0) {
                try {
                    inbodyUrl = await uploadToImageKit(inbodyFiles[0], inbodyFolder);
                    uploadedCount++;
                    updateProgress(uploadedCount, totalFiles);
                } catch (error) {
                    console.error('InBody upload error:', error);
                }
            }
            
            document.getElementById('uploadProgress').classList.remove('active');
            
            // ÁîüÊàêÁõ∏Á∞øÈÄ£Áµê
            var albumUrl = '';
            if (motiUrls.length > 0) {
                albumUrl = CONFIG.ALBUM_BASE_URL + 
                    '?member=' + encodeURIComponent(memberName) +
                    '&date=' + assessmentDate +
                    '&images=' + encodeURIComponent(motiUrls.join(','));
            }
            
            return {
                motiUrls: motiUrls,
                inbodyUrl: inbodyUrl,
                motiFolder: albumUrl
            };
        }

        function updateProgress(current, total) {
            var percent = Math.round((current / total) * 100);
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = current + ' / ' + total + ' (' + percent + '%)';
        }

        // ==================== Ë°®ÂñÆÊî∂ÈõÜËàáÊèê‰∫§ ====================
        function collectFormData() {
            var dateValue = document.getElementById('assessmentDate').value;
            var timeValue = document.getElementById('assessmentTime').value || '00:00';
            
            var data = {
                // ÊúÉÂì°Ë≥áÊñôÔºàÂÑ™ÂÖà‰ΩøÁî®Êü•Ë©¢ÁµêÊûúÔºâ
                memberId: memberData ? memberData.id : '',
                memberName: memberData ? memberData.name : document.getElementById('memberName').value,
                memberPhone: memberData ? memberData.phone : document.getElementById('memberPhone').value,
                assessmentDate: dateValue,
                assessmentTime: timeValue,
                assessmentDateTime: dateValue + ' ' + timeValue + ':00',
                
                // ÂàÜÊûêÂ∏´Ë≥áÊñô
                analystId: analystData ? analystData.id : '',
                analystName: analystData ? analystData.name : '',
                analystLineId: document.getElementById('analystLineId').value,
                
                // ÂÄã‰∫∫Ë≥áÊñô
                goals: Array.from(document.querySelectorAll('input[name="goals"]:checked')).map(function(el) { return el.value; }),
                diseases: collectDiseaseData(),
                notes: document.getElementById('notes').value,
                exerciseExperience: document.querySelector('input[name="exercise"]:checked')?.value || '',
                exerciseType: document.getElementById('exerciseType').value,
                exerciseDuration: document.getElementById('exerciseDuration').value,
                
                // È¢®Èö™ÊéíÂêç
                risks: {
                    risk1: document.getElementById('risk1').value,
                    risk2: document.getElementById('risk2').value,
                    risk3: document.getElementById('risk3').value
                },
                
                // È™®È™ºË©ï‰º∞ÔºàÁç®Á´ãÊ¨Ñ‰ΩçÔºâ
                skeleton: {
                    // Ê≠•È©ü1 ËÑäÊ§éÂÅ¥ÂΩé
                    scoliosis: document.querySelector('input[name="scoliosis"]:checked')?.value || '',
                    thoracicCurveDegree: document.getElementById('thoracicCurveDegree').value,
                    thoracicCurveDirection: document.querySelector('input[name="thoracicCurve"]:checked')?.value || '',
                    lumbarCurveDegree: document.getElementById('lumbarCurveDegree').value,
                    lumbarCurveDirection: document.querySelector('input[name="lumbarCurve"]:checked')?.value || '',
                    // Ê≠•È©ü2 È†∏Ê§é
                    cervicalStatus: document.querySelector('input[name="cervical"]:checked')?.value || '',
                    cervicalDegree: document.getElementById('cervicalDegree').value,
                    // Ê≠•È©ü3 ËÉ∏Ê§é
                    thoracicStatus: document.querySelector('input[name="thoracic"]:checked')?.value || '',
                    thoracicDegree: document.getElementById('thoracicDegree').value,
                    // Ê≠•È©ü4 ËÖ∞Ê§é
                    lumbarStatus: document.querySelector('input[name="lumbar"]:checked')?.value || '',
                    lumbarDegree: document.getElementById('lumbarDegree').value,
                    // Ê≠•È©ü5 È™®ÁõÜ
                    pelvisTilt: document.querySelector('input[name="pelvisTilt"]:checked')?.value || '',
                    pelvisTiltDegree: document.getElementById('pelvisTiltDegree').value,
                    pelvisSide: document.querySelector('input[name="pelvisSide"]:checked')?.value || '',
                    pelvisSideDegree: document.getElementById('pelvisSideDegree').value,
                    pelvisUpDown: document.querySelector('input[name="pelvisUpDown"]:checked')?.value || '',
                    pelvisRotation: document.querySelector('input[name="pelvisRotation"]:checked')?.value || '',
                    functionalTilt: document.getElementById('functionalTilt').checked ? 'ÊòØ' : 'Âê¶',
                    // Ê≠•È©ü6 ËÜùËìã
                    leftKnee: document.querySelector('input[name="leftKnee"]:checked')?.value || '',
                    leftKneeDegree: document.getElementById('leftKneeDegree').value,
                    rightKnee: document.querySelector('input[name="rightKnee"]:checked')?.value || '',
                    rightKneeDegree: document.getElementById('rightKneeDegree').value,
                    // Ê≠•È©ü7 ËÖ≥Ë∏ù
                    arch: document.querySelector('input[name="arch"]:checked')?.value || '',
                    footRotation: document.querySelector('input[name="footRotation"]:checked')?.value || '',
                    // Ê≠•È©ü8 ËÇ©ÈóúÁØÄ
                    shrug: document.querySelector('input[name="shrug"]:checked')?.value || '',
                    roundShoulder: document.querySelector('input[name="roundShoulder"]:checked')?.value || '',
                    scapula: document.querySelector('input[name="scapula"]:checked')?.value || '',
                    humerus: document.querySelector('input[name="humerus"]:checked')?.value || '',
                    // Ê≠•È©ü9 È´ñËÜùË∏ù
                    hip: document.querySelector('input[name="hip"]:checked')?.value || '',
                    kneeStability: document.querySelector('input[name="kneeStability"]:checked')?.value || '',
                    ankleStability: document.querySelector('input[name="ankleStability"]:checked')?.value || '',
                    // Ê≠•È©ü10 ÂëºÂê∏
                    breathingShallow: document.querySelector('input[name="breathingShallow"]:checked')?.value || '',
                    breathingPattern: document.querySelector('input[name="breathingPattern"]:checked')?.value || ''
                },
                
                // È™®È™ºË©ï‰º∞ÂÇôË®ªÔºàÁç®Á´ãÊ¨Ñ‰ΩçÔºâ
                skeletonNotes: {
                    scoliosis: document.getElementById('scoliosisNote')?.value || '',
                    thoracicCurve: document.getElementById('thoracicCurveNote')?.value || '',
                    lumbarCurve: document.getElementById('lumbarCurveNote')?.value || '',
                    cervical: document.getElementById('cervicalNote')?.value || '',
                    thoracic: document.getElementById('thoracicNote')?.value || '',
                    lumbar: document.getElementById('lumbarNote')?.value || '',
                    pelvisTilt: document.getElementById('pelvisTiltNote')?.value || '',
                    pelvisSide: document.getElementById('pelvisSideNote')?.value || '',
                    pelvisRotation: document.getElementById('pelvisRotationNote')?.value || '',
                    functionalTilt: document.getElementById('functionalTiltNote')?.value || '',
                    leftKnee: document.getElementById('leftKneeNote')?.value || '',
                    rightKnee: document.getElementById('rightKneeNote')?.value || '',
                    arch: document.getElementById('archNote')?.value || '',
                    footRotation: document.getElementById('footRotationNote')?.value || '',
                    shrug: document.getElementById('shrugNote')?.value || '',
                    roundShoulder: document.getElementById('roundShoulderNote')?.value || '',
                    scapula: document.getElementById('scapulaNote')?.value || '',
                    humerus: document.getElementById('humerusNote')?.value || '',
                    hip: document.getElementById('hipNote')?.value || '',
                    kneeStability: document.getElementById('kneeStabilityNote')?.value || '',
                    ankleStability: document.getElementById('ankleStabilityNote')?.value || '',
                    breathingShallow: document.getElementById('breathingShallowNote')?.value || '',
                    breathingPattern: document.getElementById('breathingPatternNote')?.value || ''
                },
                
                // ËÇåËÇâÂºµÂäõÔºàJSON Ê†ºÂºèÔºâ
                muscles: collectMuscleData(),
                
                // ËÇåËÇâÂºµÂäõÔºàÊñáÂ≠óÊ†ºÂºèÔºåÁµ¶ Google Sheet Áî®Ôºâ
                muscleText: formatMuscleText(),
                
                // ÂàÜÊûêÂ∏´Âª∫Ë≠∞
                suggestions: {
                    shortTermGoal: document.getElementById('shortTermGoal').value,
                    totalCourses: document.getElementById('totalCourses').value,
                    weightTraining: document.getElementById('weightTraining').value,
                    pilatesTraining: document.getElementById('pilatesTraining').value,
                    stretchTraining: document.getElementById('stretchTraining').value,
                    clientUnderstand: document.querySelector('input[name="clientUnderstand"]:checked')?.value || '',
                    functionalTraining: document.getElementById('functionalTraining').value,
                    fasciaRelease: document.getElementById('fasciaRelease').value,
                    coachRatings: collectCoachRatings(),
                    // ÊïôÁ∑¥Êé®Ëñ¶ÔºàÊñáÂ≠óÊ†ºÂºèÔºåÁµ¶ Google Sheet Áî®Ôºâ
                    weightCoachText: formatCoachText('weight'),
                    pilatesCoachText: formatCoachText('pilates'),
                    stretchCoachText: formatCoachText('stretch'),
                    precautions: document.getElementById('precautions').value,
                    serviceNotes: document.getElementById('serviceNotes').value
                }
            };
            
            
            return data;
        }
        
        function collectDiseaseData() {
            var diseases = [];
            document.querySelectorAll('input[name="disease"]:checked').forEach(function(el) {
                var value = el.value;
                // Â¶ÇÊûúÊòØÂ∏∂ÊñáÂ≠óÊ¨ÑÁöÑÈÅ∏È†ÖÔºåÈôÑÂä†Ë™™Êòé
                if (value === 'ÈóúÁØÄÂïèÈ°å') {
                    var detail = document.getElementById('jointInput').value.trim();
                    diseases.push(detail ? value + 'Ôºö' + detail : value);
                } else if (value === 'ËÑäÊ§éÂïèÈ°å') {
                    var detail = document.getElementById('spineInput').value.trim();
                    diseases.push(detail ? value + 'Ôºö' + detail : value);
                } else if (value === 'ÂÖ∂‰ªñ') {
                    var detail = document.getElementById('otherDiseaseInput').value.trim();
                    diseases.push(detail ? value + 'Ôºö' + detail : value);
                } else {
                    diseases.push(value);
                }
            });
            return diseases;
        }
        
        function formatMuscleText() {
            var muscles = collectMuscleData();
            var result = {};
            
            Object.keys(muscles).forEach(function(group) {
                var entries = muscles[group];
                if (entries.length === 0) {
                    result[group] = '';
                } else {
                    result[group] = entries.map(function(m, index) {
                        var lines = [];
                        lines.push('„Äê' + (index + 1) + '„Äë' + (m.name || 'Êú™ÂëΩÂêç'));
                        if (m.status) lines.push('ÁãÄÊÖãÔºö' + m.status);
                        if (m.side) lines.push('ÂÅ¥ÈÇäÔºö' + m.side);
                        if (m.level) lines.push('Á≠âÁ¥öÔºö' + m.level);
                        if (m.suggest) lines.push('Âª∫Ë≠∞Ôºö' + m.suggest);
                        if (m.note) lines.push('ÂÇôË®ªÔºö' + m.note);
                        return lines.join('ÔΩú');
                    }).join('\n');
                }
            });
            
            return result;
        }

        function collectMuscleData() {
            var muscles = {};
            ['shoulder', 'chest', 'back', 'core', 'glute', 'leg'].forEach(function(group) {
                var containerId = group === 'shoulder' ? 'shoulderMuscles' : 
                                  group === 'chest' ? 'chestMuscles' :
                                  group === 'back' ? 'backMuscles' :
                                  group === 'core' ? 'coreMuscles' :
                                  group === 'glute' ? 'gluteMuscles' : 'legMuscles';
                var container = document.getElementById(containerId);
                var entries = container.querySelectorAll('.muscle-entry');
                muscles[group] = [];
                entries.forEach(function(entry) {
                    var id = entry.id;
                    muscles[group].push({
                        name: entry.querySelector('.muscle-name-input').value,
                        status: document.querySelector('input[name="' + id + '_status"]:checked')?.value || '',
                        side: document.querySelector('input[name="' + id + '_side"]:checked')?.value || '',
                        level: document.querySelector('input[name="' + id + '_level"]:checked')?.value || '',
                        suggest: document.querySelector('input[name="' + id + '_suggest"]:checked')?.value || '',
                        note: document.getElementById(id + '_note')?.value || ''
                    });
                });
            });
            return muscles;
        }

        function collectCoachRatings() {
            var ratings = {
                weight: [],
                pilates: [],
                stretch: []
            };
            
            document.querySelectorAll('.half-star-rating').forEach(function(el) {
                var rating = parseFloat(el.dataset.value) || 0;
                if (rating > 0) {
                    var type = el.dataset.type;
                    var name = el.dataset.name;
                    if (type && ratings[type]) {
                        ratings[type].push({
                            name: name,
                            rating: rating
                        });
                    }
                }
            });
            
            return ratings;
        }
        
        // Ê†ºÂºèÂåñÊïôÁ∑¥Êé®Ëñ¶ÔºàÊéíÂ∫è + ËΩâÂ≠ó‰∏≤Ôºâ
        function formatCoachRatings(ratings) {
            function sortAndFormat(list) {
                if (!list || list.length === 0) return '';
                // ‰æùÊòüÊï∏Áî±È´òÂà∞‰ΩéÊéíÂ∫è
                list.sort(function(a, b) { return b.rating - a.rating; });
                // Ê†ºÂºèÂåñÔºöÁéãÊïôÁ∑¥:3Êòü, ÊùéÊïôÁ∑¥:2.5Êòü
                return list.map(function(item) {
                    return item.name + ':' + item.rating + 'Êòü';
                }).join(', ');
            }
            
            return {
                weightCoaches: sortAndFormat(ratings.weight),
                pilatesCoaches: sortAndFormat(ratings.pilates),
                stretchCoaches: sortAndFormat(ratings.stretch)
            };
        }
        
        // Ê†ºÂºèÂåñÊïôÁ∑¥Ë©ïÂàÜÁÇ∫ÊñáÂ≠óÔºàÁµ¶ Google Sheet Áî®Ôºâ
        function formatCoachText(coachType) {
            var result = [];
            document.querySelectorAll('.half-star-rating[data-type="' + coachType + '"]').forEach(function(el) {
                var rating = parseFloat(el.dataset.value) || 0;
                if (rating > 0) {
                    var name = el.dataset.name;
                    result.push({ name: name, rating: rating });
                }
            });
            // ‰æùÊòüÊï∏Áî±È´òÂà∞‰ΩéÊéíÂ∫è
            result.sort(function(a, b) { return b.rating - a.rating; });
            // Ê†ºÂºèÂåñËº∏Âá∫
            return result.map(function(item) {
                return item.name + '(' + item.rating + 'Êòü)';
            }).join(', ');
        }

        async function submitAssessment() {
            var formData = collectFormData();
            
            // Debug: Á¢∫Ë™çÊó•ÊúüÊôÇÈñìÂÄº
            console.log('Êèê‰∫§ÊôÇÁöÑÊó•Êúü:', formData.assessmentDate);
            console.log('Êèê‰∫§ÊôÇÁöÑÊôÇÈñì:', formData.assessmentTime);
            console.log('ÂÆåÊï¥Êó•ÊúüÊôÇÈñì:', formData.assessmentDateTime);
            
            // È©óË≠âÂøÖÂ°´
            if (!formData.memberName || !formData.memberPhone) {
                showToast('Ë´ãÂ°´ÂØ´ÊúÉÂì°ÂßìÂêçÂíåÈõªË©±');
                return;
            }
            
            // È©óË≠âÊòØÂê¶Â∑≤Êü•Ë©¢ÂèñÂæóÂ≠∏ÁîüÁ∑®Ëôü
            if (!formData.memberId) {
                showToast('Ë´ãÂÖàÈªûÊìä„ÄåÊü•Ë©¢„ÄçÂèñÂæóÂ≠∏ÁîüÁ∑®Ëôü');
                return;
            }
            
            showLoading('Ê≠£Âú®Êèê‰∫§...');
            document.getElementById('submitBtn').disabled = true;
            
            try {
                // ‰∏äÂÇ≥ÂúñÁâá
                var memberId = formData.memberId;
                var imageData = await uploadAllImages(memberId, formData.memberName, formData.assessmentDate);
                
                // Êï¥ÂêàË≥áÊñô
                formData.images = {
                    motiUrls: imageData.motiUrls,
                    motiFolder: imageData.motiFolder,
                    motiCount: imageData.motiUrls.length,
                    inbodyUrl: imageData.inbodyUrl
                };
                
                // Êèê‰∫§Âà∞ Make
                var response = await fetch(CONFIG.MAKE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'submit_assessment',
                        data: formData
                    })
                });
                
                var result = await response.json();
                hideLoading();
                document.getElementById('submitBtn').disabled = false;
                
                if (result.success) {
                    showSuccess(formData, imageData);
                } else {
                    showToast('Êèê‰∫§Â§±ÊïóÔºö' + (result.error || 'Êú™Áü•ÈåØË™§'));
                }
            } catch (error) {
                hideLoading();
                document.getElementById('submitBtn').disabled = false;
                showToast('Êèê‰∫§Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                console.error('Submit error:', error);
            }
        }
        
        function showSuccess(formData, imageData) {
            var details = '<p><strong>ÊúÉÂì°ÂßìÂêçÔºö</strong>' + formData.memberName + '</p>' +
                '<p><strong>Ê™¢Ê∏¨Êó•ÊúüÊôÇÈñìÔºö</strong>' + formData.assessmentDate + ' ' + formData.assessmentTime + '</p>' +
                '<p><strong>Moti ÁÖßÁâáÔºö</strong>' + (imageData.motiUrls.length || 0) + ' ÂºµÂ∑≤‰∏äÂÇ≥</p>' +
                '<p><strong>InBody ÁÖßÁâáÔºö</strong>' + (imageData.inbodyUrl ? '1 ÂºµÂ∑≤‰∏äÂÇ≥' : 'ÁÑ°') + '</p>';
            
            document.getElementById('successDetails').innerHTML = details;
            document.getElementById('successOverlay').classList.add('active');
        }
        
        function closeSuccess() {
            document.getElementById('successOverlay').classList.remove('active');
        }
        
        function closeSuccessAndReset() {
            closeSuccess();
            // ÈáçÁΩÆË°®ÂñÆ
            location.reload();
        }

        // ==================== Â∑•ÂÖ∑ÂáΩÊï∏ ====================
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text || 'ËôïÁêÜ‰∏≠...';
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showToast(m) {
            var t = document.getElementById('toast');
            t.textContent = m;
            t.classList.add('show');
            setTimeout(function() { t.classList.remove('show'); }, 3000);
        }

        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

        // ==================== È†ÅÈù¢Â∞éËà™ ====================
        function nextPage() { if (currentPage < 5) { currentPage++; updatePage(); scrollToTop(); } }
        function prevPage() { if (currentPage > 1) { currentPage--; updatePage(); scrollToTop(); } }
        function goToPage(p) { currentPage = p; updatePage(); scrollToTop(); }

        function updatePage() {
            document.querySelectorAll('.progress-step').forEach(function(s, i) {
                s.classList.remove('active', 'completed');
                if (i + 1 < currentPage) s.classList.add('completed');
                if (i + 1 === currentPage) s.classList.add('active');
            });
            document.querySelectorAll('.progress-line').forEach(function(l, i) { l.classList.toggle('completed', i + 1 < currentPage); });
            document.querySelectorAll('.main-content').forEach(function(c, i) { c.classList.toggle('active', i + 1 === currentPage); });
            if (currentPage === 3) updateSkeletonStep();
            if (currentPage === 4) updateMuscleStep();
        }

        function toggleExerciseDetails() {
            var cb = document.querySelector('input[name="exercise"][value="Êúâ"]');
            document.getElementById('exerciseDetails').style.display = cb.checked ? 'block' : 'none';
        }
        
        function toggleDiseaseInput(inputId, checkbox) {
            var input = document.getElementById(inputId);
            if (checkbox.checked) {
                input.disabled = false;
                input.focus();
            } else {
                input.disabled = true;
                input.value = '';
            }
        }

        // ==================== È™®È™ºË©ï‰º∞Ê≠•È©ü ====================
        function renderSkeletonHotspots() {
            var overlay = document.getElementById('skeletonOverlay');
            overlay.innerHTML = '';
            var imageType = stepImageConfig[currentSkeletonStep];
            var hotspots = imageType === 'fb' ? hotspotsFB : hotspotsFS;
            
            hotspots.forEach(function(spot) {
                var h = document.createElement('div');
                h.className = 'hotspot skeleton-hotspot visible';
                if (spot.steps.indexOf(currentSkeletonStep) >= 0) h.className += ' active';
                h.style.left = spot.x + '%';
                h.style.top = spot.y + '%';
                h.innerHTML = '<div class="hotspot-tooltip">' + spot.label + '</div>';
                overlay.appendChild(h);
            });
        }

        function updateSkeletonStep() {
            document.getElementById('currentStepNum').textContent = currentSkeletonStep;
            document.querySelectorAll('.skeleton-step').forEach(function(s, i) {
                s.classList.toggle('active', i === currentSkeletonStep);
                s.style.display = i === currentSkeletonStep ? 'block' : 'none';
            });
            
            var imageType = stepImageConfig[currentSkeletonStep];
            document.getElementById('skeletonFS').classList.toggle('active', imageType === 'fs');
            document.getElementById('skeletonFB').classList.toggle('active', imageType === 'fb');
            document.getElementById('rightHint').textContent = imageType === 'fb' ? 'ËÉåÈù¢ ‚Üí' : 'ÂÅ¥Èù¢ ‚Üí';
            
            renderSkeletonHotspots();
            document.getElementById('prevStepBtn').style.visibility = currentSkeletonStep === 0 ? 'hidden' : 'visible';
            document.getElementById('nextStepBtn').style.display = currentSkeletonStep === 10 ? 'none' : 'inline-block';
        }

        function nextSkeletonStep() { if (currentSkeletonStep < 10) { currentSkeletonStep++; updateSkeletonStep(); } }
        function prevSkeletonStep() { if (currentSkeletonStep > 0) { currentSkeletonStep--; updateSkeletonStep(); } }

        // ==================== ËÇåËÇâË©ï‰º∞ ====================
        function initMuscleHotspots() {
            var overlay = document.getElementById('muscleOverlay');
            overlay.innerHTML = '';
            muscleHotspots.forEach(function(spot) {
                var h = document.createElement('div');
                h.className = 'hotspot muscle-hotspot visible';
                h.style.left = spot.x + '%';
                h.style.top = spot.y + '%';
                h.dataset.group = spot.group;
                h.dataset.label = spot.label;
                h.innerHTML = '<div class="hotspot-tooltip">' + spot.label + '</div>';
                
                // ÈªûÊìäÁÜ±ÈªûËá™ÂãïÂ°´ÂÖ•ËÇåËÇâÂêçÁ®±
                h.addEventListener('click', function() {
                    if (lastMuscleInput && lastMuscleInput.value === '') {
                        lastMuscleInput.value = spot.label;
                        showToast('Â∑≤Â°´ÂÖ•Ôºö' + spot.label);
                    } else if (!lastMuscleInput) {
                        showToast('Ë´ãÂÖàÈªûÊìä„Äå+ Êñ∞Â¢ûËÇåËÇâ„ÄçÊåâÈàï');
                    } else {
                        showToast('ÁõÆÂâçËº∏ÂÖ•Ê°ÜÂ∑≤ÊúâÂÖßÂÆπÔºåË´ãÊñ∞Â¢ûËÇåËÇâÊàñÊ∏ÖÁ©∫');
                    }
                });
                
                overlay.appendChild(h);
            });
        }

        function updateMuscleStep() {
            document.getElementById('currentMuscleStep').textContent = currentMuscleStepIndex + 1;
            var currentGroup = muscleGroups[currentMuscleStepIndex];
            document.querySelectorAll('.muscle-step').forEach(function(s) {
                var isActive = s.dataset.group === currentGroup;
                s.classList.toggle('active', isActive);
                s.style.display = isActive ? 'block' : 'none';
            });
            document.querySelectorAll('.muscle-hotspot').forEach(function(h) {
                h.classList.toggle('active', h.dataset.group === currentGroup);
            });
            document.getElementById('prevMuscleBtn').style.visibility = currentMuscleStepIndex === 0 ? 'hidden' : 'visible';
            document.getElementById('nextMuscleBtn').style.display = currentMuscleStepIndex === 5 ? 'none' : 'inline-block';
        }

        function nextMuscleStep() { if (currentMuscleStepIndex < 5) { currentMuscleStepIndex++; updateMuscleStep(); } }
        function prevMuscleStep() { if (currentMuscleStepIndex > 0) { currentMuscleStepIndex--; updateMuscleStep(); } }

        function addMuscleEntry(containerId, group) {
            var container = document.getElementById(containerId);
            
            // ÈôêÂà∂ÊúÄÂ§ö10ÂÄãËÇåËÇâ
            var existingEntries = container.querySelectorAll('.muscle-entry');
            if (existingEntries.length >= 10) {
                alert('ÊØèÂÄãËÇåÁæ§ÊúÄÂ§öÂè™ËÉΩÊñ∞Â¢û 10 ÂÄãËÇåËÇâÈÉ®‰Ωç');
                return;
            }
            
            var hint = container.querySelector('.empty-muscle-hint');
            if (hint) hint.remove();
            
            var entryId = 'entry_' + (++muscleEntryCounter);
            var sideOptions = { shoulder: ['ÂÖ©ÂÅ¥', 'Â∑¶ÂÅ¥', 'Âè≥ÂÅ¥'], chest: ['ÂÖ©ÂÅ¥', 'Â∑¶ÂÅ¥', 'Âè≥ÂÅ¥'], back: ['ÂÖ©ÂÅ¥', 'Â∑¶ÂÅ¥', 'Âè≥ÂÅ¥'], core: ['Êï¥È´î'], glute: ['ÂÖ©ÂÅ¥', 'Â∑¶ËáÄ', 'Âè≥ËáÄ'], leg: ['ÈõôËÖ≥', 'Â∑¶ËÖ≥', 'Âè≥ËÖ≥'] };
            var sides = sideOptions[group] || ['ÂÖ©ÂÅ¥', 'Â∑¶ÂÅ¥', 'Âè≥ÂÅ¥'];
            var entry = document.createElement('div');
            entry.className = 'muscle-entry';
            entry.id = entryId;
            var sidesHtml = sides.map(function(s) { return '<label class="radio-btn"><input type="radio" name="' + entryId + '_side" value="' + s + '"><span class="circle"></span><span>' + s + '</span></label>'; }).join('');
            entry.innerHTML = '<div class="muscle-entry-header"><input type="text" class="muscle-name-input" placeholder="ÈªûÊìäÂúñÁâáÊàñÊâãÂãïËº∏ÂÖ•ËÇåËÇâÂêçÁ®±"><button class="remove-entry-btn" onclick="removeMuscleEntry(\''+entryId+'\', \''+containerId+'\')">√ó</button></div><div class="muscle-option-row"><span class="muscle-option-label">ÁãÄÊÖã</span><div class="radio-group"><label class="radio-btn"><input type="radio" name="'+entryId+'_status" value="Á∑äÁπÉ"><span class="circle"></span><span>Á∑äÁπÉ</span></label><label class="radio-btn"><input type="radio" name="'+entryId+'_status" value="ÁÑ°Âäõ"><span class="circle"></span><span>ÁÑ°Âäõ</span></label></div></div><div class="muscle-option-row"><span class="muscle-option-label">ÂÅ¥ÈÇä</span><div class="radio-group">' + sidesHtml + '</div></div><div class="muscle-option-row"><span class="muscle-option-label">Á≠âÁ¥ö</span><div class="radio-group"><label class="radio-btn"><input type="radio" name="'+entryId+'_level" value="6"><span class="circle"></span><span>6</span></label><label class="radio-btn"><input type="radio" name="'+entryId+'_level" value="7"><span class="circle"></span><span>7</span></label><label class="radio-btn"><input type="radio" name="'+entryId+'_level" value="8"><span class="circle"></span><span>8</span></label><label class="radio-btn"><input type="radio" name="'+entryId+'_level" value="9"><span class="circle"></span><span>9</span></label><label class="radio-btn"><input type="radio" name="'+entryId+'_level" value="10"><span class="circle"></span><span>10</span></label></div><span style="color: #999; font-size: 0.7rem; margin-left: 4px;">(moti)</span></div><div class="muscle-option-row"><span class="muscle-option-label">Âª∫Ë≠∞</span><div class="radio-group"><label class="radio-btn"><input type="radio" name="'+entryId+'_suggest" value="Ë®ìÁ∑¥"><span class="circle"></span><span>Ë®ìÁ∑¥</span></label><label class="radio-btn"><input type="radio" name="'+entryId+'_suggest" value="ÊîæÈ¨Ü"><span class="circle"></span><span>ÊîæÈ¨Ü</span></label></div><input type="text" class="suggest-note-input" placeholder="ÂÇôË®ªË™™Êòé" id="'+entryId+'_note"></div>';
            container.appendChild(entry);
            
            // ËøΩËπ§ÊúÄËøëÊñ∞Â¢ûÁöÑËº∏ÂÖ•Ê°Ü
            lastMuscleInput = entry.querySelector('.muscle-name-input');
            lastMuscleInput.focus();
        }
        
        function removeMuscleEntry(entryId, containerId) {
            document.getElementById(entryId).remove();
            var container = document.getElementById(containerId);
            if (!container.querySelector('.muscle-entry')) {
                container.innerHTML = '<div class="empty-muscle-hint">Â∞öÊú™Êñ∞Â¢ûËÇåËÇâÔºåË´ãÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢û</div>';
            }
        }

        // ==================== Â†ÇÊï∏Ë®àÁÆó ====================
        function updateTotalCourses() {
            var weight = parseInt(document.getElementById('weightTraining').value) || 0;
            var pilates = parseInt(document.getElementById('pilatesTraining').value) || 0;
            var stretch = parseInt(document.getElementById('stretchTraining').value) || 0;
            document.getElementById('totalCourses').value = weight + pilates + stretch;
        }

        // ==================== ÊïôÁ∑¥Ë©ïÂàÜ ====================
        function initHalfStarRatings() {
            document.querySelectorAll('.half-star-rating').forEach(function(rating) {
                rating.dataset.value = 0;
                rating.querySelectorAll('.star-container').forEach(function(container) {
                    container.addEventListener('click', function(e) {
                        var starNum = parseInt(this.dataset.star);
                        var rect = this.getBoundingClientRect();
                        var clickX = e.clientX - rect.left;
                        var isHalf = clickX < rect.width / 2;
                        var newValue = isHalf ? starNum - 0.5 : starNum;
                        if (parseFloat(rating.dataset.value) === newValue) newValue = 0;
                        rating.dataset.value = newValue;
                        updateStarDisplay(rating, newValue);
                    });
                });
            });
        }

        function updateStarDisplay(rating, value) {
            rating.querySelectorAll('.star-container').forEach(function(container, index) {
                var fill = container.querySelector('.star-fill');
                var starNum = index + 1;
                if (value >= starNum) fill.style.width = '100%';
                else if (value >= starNum - 0.5) fill.style.width = '50%';
                else fill.style.width = '0%';
            });
            rating.querySelector('.rating-value').textContent = value;
        }
    </script>
</body>
</html>

